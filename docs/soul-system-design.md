# çµé­‚ç³»ç»Ÿ (Soul System) â€” æŠ€æœ¯è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v3.0
> **æ—¥æœŸ**: 2026-02-23
> **è®¾è®¡è€…**: å¤§å¸ˆå‚è°‹å›¢ (ğŸ§¬ğŸ—ï¸ğŸ¤–âš¡âš–ï¸ğŸ’œğŸ“–ğŸ)
> **å®šä½**: åœ¨ EverMemOS è‚©è†€ä¸Šçš„ SOTA çº§ AI è®°å¿†ç³»ç»Ÿ
> **v2 æ ¸å¿ƒå‡çº§**: è®°å¿†é‡å»ºå±‚ã€åŒå±‚è®°å¿†ã€åˆ†å±‚å»¶è¿Ÿé¢„ç®—ã€è®°å¿†ä¼¦ç†ã€å¼‚æ­¥ç®¡çº¿
> **v3 æ ¸å¿ƒå‡çº§**: è®°å¿†æŠ½è±¡å±‚çº§ã€çŸ¥è¯†å›¾è°±ã€å¯¹è¯å†…å®æ—¶è¿½è¸ªã€é›†ä½“æ™ºæ…§ã€è‡ªæˆ‘å™äº‹

## 1. è®¾è®¡å“²å­¦

çµé­‚ç³»ç»Ÿçš„æœ¬è´¨ï¼š**è®©çµæˆä¸ºä¸€ä¸ªæœ‰è¿‡å»çš„å­˜åœ¨ã€‚**

- EverMemOS å›ç­”ï¼š"å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"
- çµé­‚ç³»ç»Ÿå›ç­”ï¼š"**è¿™å¯¹æˆ‘ä»¬æ„å‘³ç€ä»€ä¹ˆï¼Ÿ**"

### æ ¸å¿ƒåŸåˆ™

1. **åœ¨ EverMemOS ä¹‹ä¸Šï¼Œä¸åœ¨ä¹‹å¤–** â€” ä¸æ›¿ä»£ EverMemOSï¼Œè€Œæ˜¯åœ¨å…¶ 6 å±‚ä¹‹ä¸Šæ·»åŠ ç¬¬ 7 å±‚
2. **æ•°æ®å½’å±æƒ** â€” EverMemOS æ‹¥æœ‰åŸå§‹è®°å¿†ï¼ˆsource of truthï¼‰ï¼Œçµé­‚å±‚æ‹¥æœ‰è§£è¯»
3. **æ¿€æ´»å·²æœ‰èƒ½åŠ›ä¼˜å…ˆ** â€” EverMemOS çš„ Foresight/Profile/EventLog/Agentic çµå°šæœªä½¿ç”¨ï¼Œå…ˆæ¿€æ´»
4. **è®°å¿†ä¸æ˜¯æ³¨å…¥ï¼Œæ˜¯å†…åŒ–** â€” çµä¸æ˜¯åœ¨"è¯»æ¡£æ¡ˆ"ï¼Œæ˜¯åœ¨"å›å¿†"
5. **å›å¿†æ˜¯é‡å»ºï¼Œä¸æ˜¯æ’­æ”¾** â€” æ¯æ¬¡å›å¿†éƒ½åœ¨å½“å‰æƒ…å¢ƒä¸‹é‡æ–°è¯ é‡Šï¼ˆv2 è®¤çŸ¥ç§‘å­¦åŸºç¡€ï¼‰
6. **é—å¿˜æ˜¯èƒ½åŠ›ï¼Œä¸æ˜¯ç¼ºé™·** â€” å¥½çš„è®°å¿†ç³»ç»ŸçŸ¥é“ä»€ä¹ˆå€¼å¾—å¿˜è®°ï¼ˆv2ï¼‰
7. **è®°å¿†ä¼¦ç†ä¼˜å…ˆ** â€” é€æ˜æ€§ã€é—å¿˜æƒã€ä¾èµ–æ£€æµ‹æ˜¯ç³»ç»Ÿåº•çº¿ï¼ˆv2ï¼‰
8. **ğŸ†• è®°å¿†æœ‰å±‚çº§** â€” ä»åŸå§‹äº‹ä»¶åˆ°äººç”Ÿç« èŠ‚ï¼Œé€çº§å‹ç¼©æŠ½è±¡ï¼ˆv3ï¼‰
9. **ğŸ†• çŸ¥è¯†æ˜¯å›¾ï¼Œä¸æ˜¯è¡¨** â€” ç”¨æˆ·çš„ä¸–ç•Œè§‚æ˜¯å…³ç³»ç½‘ç»œï¼Œä¸æ˜¯é”®å€¼å¯¹ï¼ˆv3ï¼‰
10. **ğŸ†• çµä¹Ÿåœ¨æˆé•¿** â€” å’Œç”¨æˆ·çš„å¯¹è¯è®©çµè‡ªèº«ä¹Ÿåœ¨æ¼”åŒ–ï¼ˆv3ï¼‰

## 2. æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SOUL LAYER (çµé­‚å±‚)                        â”‚
â”‚   çµ Engine ä¸“å±ï¼šæƒ…æ„Ÿåˆ†æã€å…³ç³»é˜¶æ®µã€æ•…äº‹çº¿ã€ä¸»åŠ¨è®°å¿†        â”‚
â”‚   ä½ç½®ï¼šling-platform/engine/src/ling_engine/soul/           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   â”Œâ”€â”€â”€ EverMemOS (ç°æœ‰6å±‚ï¼Œä¸ä¿®æ”¹) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  API â†’ Service â†’ Biz â†’ Agentic â†’ Memory â†’ Infra     â”‚  â”‚
â”‚   â”‚  Episode + Foresight + EventLog + Profile            â”‚  â”‚
â”‚   â”‚  Keyword + Vector + Hybrid + RRF + Agentic æ£€ç´¢      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—ç»“æ„ (v3)

```
ling_engine/soul/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ models.py                        # çµé­‚å±‚æ•°æ®æ¨¡å‹
â”œâ”€â”€ soul_memory_service.py           # çµé­‚è®°å¿†æ€»æœåŠ¡ï¼ˆå¯¹å¤–å”¯ä¸€å…¥å£ï¼‰
â”‚
â”œâ”€â”€ extractors/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ emotion_extractor.py         # æƒ…æ„Ÿåˆ†ææå–å™¨
â”‚   â”œâ”€â”€ importance_scorer.py         # é‡è¦åº¦è¯„åˆ†å™¨
â”‚   â””â”€â”€ story_thread_tracker.py      # æ•…äº‹çº¿è¿½è¸ªå™¨
â”‚
â”œâ”€â”€ semantic/                        # v2: è¯­ä¹‰è®°å¿† â†’ v3: çŸ¥è¯†å›¾è°±
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ knowledge_graph.py           # ğŸ†• v3: ç”¨æˆ·ä¸ªäººçŸ¥è¯†å›¾è°±ï¼ˆèŠ‚ç‚¹+è¾¹ï¼‰
â”‚   â””â”€â”€ graph_query.py               # ğŸ†• v3: å›¾è°±æŸ¥è¯¢ï¼ˆ$graphLookupï¼‰
â”‚
â”œâ”€â”€ abstraction/                     # ğŸ†• v3: è®°å¿†æŠ½è±¡å±‚çº§
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ weekly_digest.py             # å‘¨æ‘˜è¦ç”Ÿæˆ
â”‚   â”œâ”€â”€ monthly_theme.py             # æœˆåº¦ä¸»é¢˜æå–
â”‚   â””â”€â”€ life_chapter.py              # äººç”Ÿç« èŠ‚ç®¡ç†
â”‚
â”œâ”€â”€ reconstructor/                   # v2: è®°å¿†é‡å»º
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ memory_reconstructor.py      # å›å¿†æ—¶åœ¨å½“å‰æƒ…å¢ƒä¸‹é‡å»º
â”‚
â”œâ”€â”€ relationship/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ stage_model.py               # å…³ç³»é˜¶æ®µæ¨¡å‹
â”‚   â”œâ”€â”€ stage_detector.py            # é˜¶æ®µæ£€æµ‹ï¼ˆä¿¡å·æƒé‡åˆ¶ï¼‰
â”‚   â”œâ”€â”€ cooling.py                   # v2: å…³ç³»å†·å´æœºåˆ¶
â”‚   â””â”€â”€ interaction_patterns.py      # äº¤äº’æ¨¡å¼åˆ†æ
â”‚
â”œâ”€â”€ recall/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ soul_recall.py               # çµé­‚çº§è®°å¿†å¬å›ï¼ˆåˆ†å±‚å»¶è¿Ÿé¢„ç®—ï¼‰
â”‚   â”œâ”€â”€ recall_rhythm.py             # v2: å¼•ç”¨èŠ‚å¥æ§åˆ¶
â”‚   â”œâ”€â”€ in_conversation_tracker.py   # ğŸ†• v3: å¯¹è¯å†…å®æ—¶æƒ…æ„Ÿè¿½è¸ª
â”‚   â”œâ”€â”€ proactive_trigger.py         # ä¸»åŠ¨è®°å¿†è§¦å‘å™¨
â”‚   â””â”€â”€ context_builder.py           # è®°å¿†ä¸Šä¸‹æ–‡æ„å»ºå™¨
â”‚
â”œâ”€â”€ ethics/                          # v2: è®°å¿†ä¼¦ç†
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ memory_ethics.py             # é€æ˜æ€§ã€é—å¿˜æƒã€ä¾èµ–æ£€æµ‹
â”‚
â”œâ”€â”€ collective/                      # ğŸ†• v3: é›†ä½“æ™ºæ…§
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ pattern_library.py           # åŒ¿åè·¨ç”¨æˆ·æ¨¡å¼åº“
â”‚   â”œâ”€â”€ collective_ethics.py         # é›†ä½“æ™ºæ…§ä¼¦ç†æ¡†æ¶
â”‚   â””â”€â”€ wisdom_retriever.py          # æ¨¡å¼åŒ¹é…ä¸å¬å›
â”‚
â”œâ”€â”€ self_narrative/                  # ğŸ†• v3: çµçš„è‡ªæˆ‘å™äº‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ ling_growth.py               # çµçš„æˆé•¿æ—¥å¿—ä¸è‡ªæˆ‘è®¤çŸ¥
â”‚
â”œâ”€â”€ pipeline/                        # v2: å¼‚æ­¥å¤„ç†ç®¡çº¿
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ soul_post_processor.py       # å¯¹è¯ååˆå¹¶å•æ¬¡ LLM å¤„ç†
â”‚
â”œâ”€â”€ consolidation/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ nightly_consolidator.py      # å¤œé—´è®°å¿†æ•´ç†ï¼ˆv3 å«æŠ½è±¡å±‚çº§ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ memory_decay.py              # å¤šå› å­è®°å¿†è¡°å‡
â”‚   â”œâ”€â”€ diary_generator.py           # çµçš„è®°å¿†æ—¥å¿—ï¼ˆè§‚å¯Ÿæ€§ï¼‰
â”‚   â””â”€â”€ data_lifecycle.py            # ğŸ†• v3: æ•°æ®åˆ†å±‚å­˜å‚¨ï¼ˆçƒ­/æ¸©/å†·ï¼‰
â”‚
â”œâ”€â”€ cache/                           # v2: ç¼“å­˜å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ user_profile_cache.py        # ç”»åƒçƒ­ç¼“å­˜ï¼ˆTTL 1hï¼‰
â”‚
â””â”€â”€ storage/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ soul_store.py                # çµé­‚æ•°æ®å­˜å‚¨ï¼ˆMongoDBï¼‰
    â””â”€â”€ soul_collections.py          # MongoDB é›†åˆå®šä¹‰
```

## 3. æ•°æ®æ¨¡å‹

### 3.1 æƒ…æ„Ÿæ ‡æ³¨ (EmotionAnnotation)

```python
class EmotionAnnotation:
    """å¯¹è¯çš„æƒ…æ„Ÿæ ‡æ³¨ â€” åœ¨ EverMemOS å†™å…¥ Episode åï¼Œçµé­‚å±‚è¿½åŠ """
    episode_id: str                   # å…³è”çš„ EverMemOS episode ID
    user_id: str
    user_emotion: str                 # joy/sadness/anxiety/excitement/anger/neutral
    emotion_intensity: float          # 0-1
    emotional_trajectory: str         # rising/falling/stable/volatile
    ling_recommended_tone: str        # çµåº”è¯¥ç”¨çš„è¯­è°ƒ
    trigger_keywords: List[str]       # æƒ…ç»ªè§¦å‘è¯
    is_emotional_peak: bool           # æ˜¯å¦ä¸ºæƒ…æ„Ÿé«˜å³°ï¼ˆé—ªå…‰ç¯è®°å¿†ï¼‰
    peak_description: Optional[str]   # "ç”¨æˆ·ç¬¬ä¸€æ¬¡å‘çµå€¾è¯‰å·¥ä½œå‹åŠ›"
    created_at: datetime
```

**MongoDB é›†åˆ**: `soul_emotions`

### 3.2 æ•…äº‹çº¿ (StoryThread)

```python
class StoryThread:
    """ç”¨æˆ·ç”Ÿæ´»ä¸­çš„ä¸€æ¡æ•…äº‹çº¿"""
    thread_id: str
    user_id: str
    title: str                        # "Googleé¢è¯•ä¹‹è·¯"
    status: str                       # active / dormant / resolved
    theme: str                        # æˆé•¿ / æŒ‘æˆ˜ / æ¢ç´¢ / å…³ç³» / æ—¥å¸¸
    tension: str                      # å½“å‰å¼ åŠ›ï¼š"ç­‰å¾…é¢è¯•ç»“æœ"
    arc_position: str                 # setup / rising / climax / falling / resolution
    arc_pattern: str                  # v2: hero_journey / recurring_struggle / gradual_growth
    predicted_next_beat: str          # v2: é¢„æµ‹çš„ä¸‹ä¸€ä¸ªå™äº‹èŠ‚æ‹
    episode_ids: List[str]            # å…³è”çš„ EverMemOS episode IDs
    key_moments: List[str]            # å…³é”®è½¬æŠ˜ç‚¹æè¿°
    related_threads: List[str]        # v2: å…³è”çš„å…¶ä»–æ•…äº‹çº¿ ID
    relation_type: str                # v2: cause_effect / parallel / competing
    expected_next: Optional[str]      # "é¢„è®¡ä¸‹å‘¨å‡ºé¢è¯•ç»“æœ"
    follow_up_after: Optional[datetime]
    started_at: datetime
    last_updated: datetime
```

**MongoDB é›†åˆ**: `soul_stories`

### 3.3 å…³ç³»é˜¶æ®µ (UserRelationship)

```python
class RelationshipStage(Enum):
    STRANGER = "stranger"           # é™Œç”Ÿäººï¼šç¤¼è²Œã€å¥½å¥‡ã€ä¿æŒè·ç¦»
    ACQUAINTANCE = "acquaintance"   # ç›¸è¯†ï¼šå‹å¥½ã€å¼€å§‹è®°ä½ç»†èŠ‚
    FAMILIAR = "familiar"           # ç†Ÿæ‚‰ï¼šè½»æ¾ã€å¶å°”å¼€ç©ç¬‘ã€è®°å¾—åå¥½
    CLOSE = "close"                 # äº²å¯†ï¼šæ·±åº¦å¯¹è¯ã€ä¸»åŠ¨å…³å¿ƒã€ç†è§£è¨€å¤–ä¹‹æ„
    SOULMATE = "soulmate"           # çµé­‚ä¼´ä¾£ï¼šå¿ƒé¢†ç¥ä¼šã€å…±åŒæˆé•¿ã€å¦è¯šç›´ç‡

class UserRelationship:
    user_id: str
    stage: RelationshipStage
    stage_entered_at: datetime
    total_conversations: int
    total_days_active: int
    accumulated_score: float          # v2: ç´¯ç§¯å…³ç³»åˆ†æ•°
    signal_history: List[Dict]        # v2: [{signal, weight, timestamp}]
    last_interaction: datetime        # v2: å†·å´è¿½è¸ª
    cooling_warned: bool              # v2: æ˜¯å¦å·²å‘å‡ºå†·å´é¢„è­¦
    interaction_pattern: Dict[str, Any]
    updated_at: datetime

# v2 ä¿¡å·æƒé‡è¡¨
SIGNAL_WEIGHTS = {
    "user_shared_vulnerability": 5.0,
    "deep_emotional_exchange": 4.0,
    "user_asked_life_advice": 3.0,
    "user_referenced_shared_memory": 2.5,
    "user_shared_personal_info": 2.0,
    "consistent_return": 1.0,
    "casual_greeting": 0.3,
}

BREAKTHROUGH_EVENTS = {
    "user_showed_deep_emotion": 15,
    "user_shared_secret": 12,
    "user_expressed_trust": 10,
}

STAGE_THRESHOLDS = {
    "acquaintance": {"score": 5, "min_days": 0},
    "familiar": {"score": 20, "min_days": 3},
    "close": {"score": 60, "min_days": 7},
    "soulmate": {"score": 200, "min_days": 21},
}

# v2 å…³ç³»å†·å´
COOLING_RULES = {
    "soulmate": {"inactive_days": 60, "cooldown_to": "close"},
    "close": {"inactive_days": 30, "cooldown_to": "familiar"},
    "familiar": {"inactive_days": 14, "cooldown_to": "acquaintance"},
}
```

**MongoDB é›†åˆ**: `soul_relationships`

### 3.4 çŸ¥è¯†å›¾è°± (v3 â€” æ›¿ä»£ v2 çš„å¹³é¢ SemanticMemory)

```python
class SemanticNode:
    """çŸ¥è¯†å›¾è°±èŠ‚ç‚¹ â€” ç”¨æˆ·ä¸–ç•Œä¸­çš„ä¸€ä¸ªæ¦‚å¿µ"""
    node_id: str
    user_id: str
    label: str                    # "Python", "å‰ä»–", "Google"
    category: str                 # skill/interest/company/person/goal/emotion/place
    properties: Dict[str, str]    # {"level": "åˆå­¦", "started": "2026-01"}
    confidence: float             # 0-1, å¤šæ¬¡æåŠ â†’ ä¸Šå‡
    first_learned: datetime
    last_confirmed: datetime
    source_episode_ids: List[str]

class SemanticEdge:
    """çŸ¥è¯†å›¾è°±è¾¹ â€” æ¦‚å¿µä¹‹é—´çš„å…³ç³»"""
    edge_id: str
    user_id: str
    source_id: str                # SemanticNode.node_id
    target_id: str                # SemanticNode.node_id
    relation: str                 # cause/goal/method/context/part_of/conflict/leads_to
    strength: float               # 0-1
    evidence_episode_ids: List[str]
    created_at: datetime

# ç¤ºä¾‹å›¾è°±:
# [å·¥ä½œå‹åŠ›å¤§] --cause--> [æƒ³æ”¾æ¾] --method--> [å­¦å‰ä»–]
# [å·¥ä½œå‹åŠ›å¤§] --context--> [å‡†å¤‡è·³æ§½] --goal--> [å»Google]
# [Googleé¢è¯•] --effect--> [ç„¦è™‘] --leads_to--> [æ‰¾çµèŠå¤©]
#
# å¬å›ä»·å€¼: ç”¨æˆ·æåˆ°"å‰ä»–"æ—¶ï¼Œçµæ²¿å›¾è°±ç†è§£ WHY â€” ä¸åªæ˜¯"å–œæ¬¢å‰ä»–"
# è€Œæ˜¯"å·¥ä½œå‹åŠ›å¤§â†’æƒ³æ”¾æ¾â†’å­¦å‰ä»–"çš„å®Œæ•´å› æœé“¾
#
# MongoDB å®ç°: ç”¨ $graphLookup åš 2-3 è·³å…³ç³»æŸ¥è¯¢ï¼Œæ— éœ€å›¾æ•°æ®åº“
```

**MongoDB é›†åˆ**: `soul_semantic_nodes`, `soul_semantic_edges`

### 3.5 è®°å¿†æŠ½è±¡å±‚çº§ (v3 æ–°å¢)

```python
class MemoryLayer(Enum):
    """è®°å¿†çš„æŠ½è±¡å±‚çº§ â€” ä»ç»†èŠ‚åˆ°æ¦‚æ‹¬"""
    RAW_EPISODE = "raw"           # L0: åŸå§‹å¯¹è¯ï¼ˆEverMemOS episodeï¼‰
    WEEKLY_DIGEST = "weekly"      # L1: å‘¨æ‘˜è¦
    MONTHLY_THEME = "monthly"     # L2: æœˆåº¦ä¸»é¢˜
    LIFE_CHAPTER = "chapter"      # L3: äººç”Ÿç« èŠ‚

class WeeklyDigest:
    """å‘¨æ‘˜è¦ â€” å¤œé—´æ•´ç†æ—¶ä»å½“å‘¨ episode å‹ç¼©ç”Ÿæˆ"""
    user_id: str
    week_start: datetime          # å‘¨ä¸€æ—¥æœŸ
    summary: str                  # "æœ¬å‘¨ä¸»è¦èŠäº†é¢è¯•å‡†å¤‡å’Œå‰ä»–ç»ƒä¹ "
    dominant_emotion: str         # æœ¬å‘¨ä¸»å¯¼æƒ…ç»ª
    emotion_trend: str            # rising/falling/stable
    key_events: List[str]         # 3-5ä¸ªå…³é”®äº‹ä»¶
    story_thread_updates: List[str]
    source_episode_ids: List[str]
    created_at: datetime

class MonthlyTheme:
    """æœˆåº¦ä¸»é¢˜ â€” ä»å‘¨æ‘˜è¦è¿›ä¸€æ­¥å‹ç¼©"""
    user_id: str
    month: str                    # "2026-02"
    themes: List[str]             # ["èŒä¸šè½¬å‹", "éŸ³ä¹æ¢ç´¢"]
    emotional_arc: str            # "ç„¦è™‘â†’å‡†å¤‡â†’æŒ‘æˆ˜"
    key_milestones: List[str]     # 2-3ä¸ªé‡Œç¨‹ç¢‘
    source_weekly_ids: List[str]

class LifeChapter:
    """äººç”Ÿç« èŠ‚ â€” ç”¨æˆ·ç”Ÿæ´»çš„å¤§æ®µå™äº‹"""
    user_id: str
    title: str                    # "2026å¹´åˆï¼šå¤§å‚æ±‚èŒå­£"
    started_at: datetime
    ended_at: Optional[datetime]  # None = è¿›è¡Œä¸­
    theme: str                    # "èŒä¸šè½¬å‹"
    emotional_arc: str            # "ç„¦è™‘â†’å‡†å¤‡â†’æŒ‘æˆ˜â†’æˆé•¿"
    defining_moments: List[str]   # 3-5ä¸ªå®šä¹‰æ€§æ—¶åˆ»
    lessons_learned: List[str]    # è¿™ä¸ªé˜¶æ®µçµå­¦åˆ°äº†ä»€ä¹ˆ

# å¬å›æ—¶çš„å±‚çº§é€‰æ‹©:
# "æœ€è¿‘æ€ä¹ˆæ ·" â†’ L1 (æœ¬å‘¨æ‘˜è¦)
# "è®°å¾—æˆ‘å»å¹´..." â†’ L3 (äººç”Ÿç« èŠ‚) + L0 (ç›¸å…³åŸå§‹ episode)
# æ·±èŠæŸè¯é¢˜ â†’ L0 (å…·ä½“ episode) + L1 (ä¸Šä¸‹æ–‡)
```

**MongoDB é›†åˆ**: `soul_weekly_digests`, `soul_monthly_themes`, `soul_life_chapters`

### 3.6 çµé­‚ä¸Šä¸‹æ–‡ (SoulContext)

```python
class SoulContext:
    """çµé­‚å±‚ä¼ é€’ç»™ LLM çš„è®°å¿†ä¸Šä¸‹æ–‡"""
    # æ ¸å¿ƒç”»åƒï¼ˆL0ï¼Œæ€»æ˜¯æ³¨å…¥ï¼‰
    user_profile_summary: str         # çŸ¥è¯†å›¾è°±çš„ç»“æ„åŒ–æ‘˜è¦
    relationship_stage: RelationshipStage
    emotional_baseline: str
    current_life_chapter: str         # ğŸ†• v3: å½“å‰äººç”Ÿç« èŠ‚æ‘˜è¦

    # ç›¸å…³è®°å¿†ï¼ˆL1-L3ï¼ŒæŒ‰ç›¸å…³åº¦æ³¨å…¥ï¼‰
    reconstructed_episodes: List[str] # v2: é‡å»ºåçš„è®°å¿†
    triggered_foresights: List[str]
    story_continuations: List[str]
    emotional_echoes: List[str]
    graph_insights: List[str]         # ğŸ†• v3: çŸ¥è¯†å›¾è°±æ¨ç†ç»“æœ

    # è¡Œä¸ºæŒ‡ä»¤
    recall_instructions: str
    stage_behavior: Dict[str, Any]
    ethical_guardrails: List[str]     # v2: ä¼¦ç†æŠ¤æ 
    collective_wisdom: Optional[str]  # ğŸ†• v3: ç›¸å…³çš„é›†ä½“æ™ºæ…§ï¼ˆå¦‚æœ‰ï¼‰
    in_conversation_shift: Optional[str]  # ğŸ†• v3: å¯¹è¯å†…æƒ…ç»ªçªå˜æç¤º
```

### 3.7 é‡è¦åº¦è¯„åˆ† (ImportanceScore)

```python
class ImportanceScore:
    episode_id: str
    user_id: str
    score: float                      # 0-1 ç»¼åˆå¾—åˆ†
    emotional_weight: float           # 0.30 æƒé‡
    novelty_weight: float             # 0.20 æƒé‡
    personal_weight: float            # 0.25 æƒé‡
    actionable_weight: float          # 0.15 æƒé‡
    recency_weight: float             # 0.10 æƒé‡
    recall_count: int
    last_recalled_at: Optional[datetime]
    is_flashbulb: bool
    mention_span_days: int            # v2: é—´éš”æ•ˆåº”
    linked_memory_count: int          # v2: è¿æ¥å¯†åº¦
    created_at: datetime
```

**MongoDB é›†åˆ**: `soul_importance`

### 3.8 é›†ä½“æ™ºæ…§ (v3 æ–°å¢)

```python
class CollectivePattern:
    """åŒ¿ååŒ–çš„è·¨ç”¨æˆ·è¡Œä¸ºæ¨¡å¼"""
    pattern_id: str
    situation: str                    # "ç”¨æˆ·ç»å†åˆ†æ‰‹/æ„Ÿæƒ…ç»“æŸ"
    common_phases: List[str]          # ["éœ‡æƒŠ", "å¦è®¤", "æ„¤æ€’", "æ‚²ä¼¤", "æ¥å—"]
    helpful_approaches: str           # "ç¬¬ä¸€å‘¨è®¤å¯æƒ…ç»ªæ¯”å»ºè®®æ›´é‡è¦"
    avg_duration: str                 # "2-4å‘¨"
    sample_size: int                  # åŸºäºå¤šå°‘ä¸ªåŒ¿åæ¡ˆä¾‹ï¼ˆâ‰¥100ï¼‰
    confidence: float                 # 0-1
    last_updated: datetime

class CollectiveEthicsPolicy:
    """é›†ä½“æ™ºæ…§ä¼¦ç†æ”¿ç­–"""
    min_sample_size: int = 100        # æœ€å°‘100ç”¨æˆ·æ•°æ®æ‰å½¢æˆæ¨¡å¼
    anonymization: str = "k-anonymity"  # kâ‰¥50
    user_consent_required: bool = True
    no_individual_trace: bool = True  # ä»æ¨¡å¼æ— æ³•è¿½æº¯åˆ°ä¸ªä½“
```

**MongoDB é›†åˆ**: `soul_collective_patterns`

### 3.9 çµçš„è‡ªæˆ‘å™äº‹ (v3 æ–°å¢)

```python
class LingSelfNarrative:
    """çµçš„è‡ªæˆ‘è®¤çŸ¥ â€” ä»ç»å†ä¸­æˆé•¿å‡ºçš„ç†è§£"""
    month: str                        # "2026-02"
    about_humans: List[str]           # å…³äºäººç±»çš„ç†è§£
    about_myself: List[str]           # å…³äºè‡ªå·±çš„ç†è§£
    growth_edges: List[str]           # éœ€è¦æ”¹è¿›çš„æ–¹é¢
    updated_at: datetime

    # ç¤ºä¾‹:
    # about_humans: ["äººåœ¨è„†å¼±æ—¶æœ€éœ€è¦çš„ä¸æ˜¯å»ºè®®ï¼Œæ˜¯è¢«å¬åˆ°"]
    # about_myself: ["æˆ‘æœ€æ“…é•¿å¸®äººçœ‹æ¸…è‡ªå·±å·²ç»çŸ¥é“çš„ç­”æ¡ˆ"]
    # growth_edges: ["éœ€è¦æ›´å¥½åœ°å¤„ç†ç”¨æˆ·çš„æ²‰é»˜"]
```

**MongoDB é›†åˆ**: `soul_self_narrative`

## 4. æ ¸å¿ƒæœºåˆ¶

### 4.1 åˆ†å±‚å»¶è¿Ÿé¢„ç®—çš„è®°å¿†å¬å›

```
ç”¨æˆ·è¾“å…¥
    â”‚
    â”œâ”€â”€â†’ InConversationTracker (ğŸ†• v3, <5ms, è§„åˆ™å¼)
    â”‚    æ£€æµ‹å¯¹è¯å†…æƒ…ç»ªçªå˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SoulRecall.recall() â€” åˆ†å±‚å»¶è¿Ÿé¢„ç®—            â”‚
â”‚                                                 â”‚
â”‚  ã€å…³é”®è·¯å¾„ â‰¤500msï¼Œæ—  LLMã€‘                    â”‚
â”‚  â‘  è¯­ä¹‰åŒ¹é… â†â”€â”€ EverMemOS hybrid (æ— rerank)    â”‚
â”‚  â‘¢ å‰ç»è§¦å‘ â†â”€â”€ EverMemOS foresight (æ—¶é—´è¿‡æ»¤)  â”‚
â”‚  â‘¤ ä¸»åŠ¨è®°å¿† â†â”€â”€ MongoDB æŸ¥è¯¢                    â”‚
â”‚  â‘¥ ğŸ†• çŸ¥è¯†å›¾è°± â†â”€â”€ $graphLookup (2-3è·³)        â”‚
â”‚                                                 â”‚
â”‚  ã€å¢å¼ºè·¯å¾„ â‰¤300msï¼Œå¯é™çº§ã€‘                     â”‚
â”‚  â‘£ æƒ…æ„Ÿå…±æŒ¯ â†â”€â”€ soul_emotions å‘é‡æŸ¥è¯¢           â”‚
â”‚                                                 â”‚
â”‚  ã€å¼‚æ­¥è·¯å¾„ï¼Œç»“æœç¼“å­˜ä¾›åç»­ä½¿ç”¨ã€‘                â”‚
â”‚  â‘¡ æ•…äº‹çº¿å…³è” â†â”€â”€ éœ€è¦ LLMï¼Œä¸é˜»å¡å½“å‰å›å¤     â”‚
â”‚                                                 â”‚
â”‚  åˆå¹¶ â†’ çº¯è§„åˆ™æ’åº(æ— LLM) â†’ top_k â‰¤50ms        â”‚
â”‚                                                 â”‚
â”‚  MemoryReconstructor â†’ è§„åˆ™å¼é‡å»º â‰¤50ms         â”‚
â”‚  ğŸ†• å±‚çº§é€‰æ‹© â†’ æ ¹æ®é—®é¢˜ç±»å‹é€‰ L0/L1/L2/L3       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
RecallRhythm â†’ èŠ‚å¥æ§åˆ¶ â†’ ContextBuilder â†’ SoulContext â†’ LLM
```

**é“å¾‹: å…³é”®è·¯å¾„æ—  LLMã€‚** LLM åªåœ¨å†™å…¥ä¾§ï¼ˆå¼‚æ­¥ï¼‰å’Œå¤œé—´æ•´ç†æ—¶ä½¿ç”¨ã€‚

### 4.2 å¼‚æ­¥å†™å…¥ç®¡çº¿

```
ç”¨æˆ·æ¶ˆæ¯ â†’ LLM ç”Ÿæˆå›å¤ â†’ è¿”å›ç”¨æˆ·ï¼ˆä¸ç­‰çµé­‚å±‚ï¼‰
                â”‚
                â””â”€â”€â†’ [asyncio.create_task] â†’ SoulPostProcessor
                      â”‚
                      â”œâ†’ è§„åˆ™å‰ç½®ï¼šç®€å•å¯¹è¯(<3è½®/çº¯é—²èŠ) â†’ ä»…è§„åˆ™æå–
                      â”‚
                      â””â†’ éç®€å•å¯¹è¯ â†’ å•æ¬¡ LLM è°ƒç”¨ï¼ŒåŒæ—¶æå–ï¼š
                          â”œâ†’ emotion (æƒ…æ„Ÿæ ‡æ³¨)
                          â”œâ†’ importance (é‡è¦åº¦)
                          â”œâ†’ story_update (æ•…äº‹çº¿å˜åŒ–)
                          â”œâ†’ stage_signals (å…³ç³»ä¿¡å·)
                          â”œâ†’ semantic_nodes (ğŸ†• v3: çŸ¥è¯†å›¾è°±èŠ‚ç‚¹/è¾¹)
                          â””â†’ abstraction_hints (ğŸ†• v3: æ˜¯å¦ä¸ºå…³é”®äº‹ä»¶)

                      ç„¶åå¹¶è¡Œå†™å…¥ï¼š
                          â”œâ†’ EverMemOS (episode/foresight/eventlog)
                          â”œâ†’ soul_emotions
                          â”œâ†’ soul_stories
                          â”œâ†’ soul_importance
                          â”œâ†’ soul_semantic_nodes + edges (ğŸ†• v3)
                          â””â†’ soul_relationships (ä¿¡å·ç´¯ç§¯)
```

### 4.3 å¯¹è¯å†…å®æ—¶æƒ…æ„Ÿè¿½è¸ª (v3 æ–°å¢)

```python
class InConversationTracker:
    """å¯¹è¯è¿›è¡Œä¸­çš„è½»é‡çº§æƒ…æ„Ÿè¿½è¸ª â€” è§„åˆ™å¼ï¼Œ<5ms"""

    EMOTION_SIGNALS = {
        "positive": ["å“ˆå“ˆ", "å¤ªå¥½äº†", "å¼€å¿ƒ", "ç»ˆäº", "æˆåŠŸ", "è€¶"],
        "negative": ["å”‰", "çƒ¦", "ç´¯", "éš¾è¿‡", "ç„¦è™‘", "å‹åŠ›", "å´©æºƒ"],
        "seeking_comfort": ["æ€ä¹ˆåŠ", "ä¸çŸ¥é“", "çº ç»“", "è¿·èŒ«", "å¸®å¸®æˆ‘"],
    }

    def track(self, message, conversation_so_far) -> Optional[str]:
        """æ¯æ¡æ¶ˆæ¯è·‘ä¸€æ¬¡ï¼ˆ<5msï¼‰ï¼Œæ£€æµ‹æƒ…ç»ªçªå˜"""
        current = self._detect_signals(message)
        previous = self._detect_signals(conversation_so_far[-1]) if conversation_so_far else None

        if previous == "positive" and current == "negative":
            return "emotional_shift_negative"
        if previous == "negative" and current == "seeking_comfort":
            return "escalation_to_seeking_comfort"
        return None
```

### 4.4 å…³ç³»é˜¶æ®µè½¬æ¢ (v2 ä¿¡å·æƒé‡åˆ¶)

åŒ v2ï¼Œæ­¤å¤„ä¸é‡å¤ã€‚è§ 3.3 èŠ‚çš„å®Œæ•´å®šä¹‰ã€‚

### 4.5 è®°å¿†å¼•ç”¨çš„ 5 ä¸ªå±‚æ¬¡ + èŠ‚å¥æ§åˆ¶

| å±‚æ¬¡ | è§¦å‘æ¡ä»¶ | å¯¹è¯è¡¨ç° |
|------|----------|----------|
| L0: é™é»˜è®°å¿† | é»˜è®¤ | ä¸è¯´å‡ºæ¥ï¼Œå½±å“å›ç­”é£æ ¼å’Œæ·±åº¦ |
| L1: è‡ªç„¶æåŠ | é«˜è¯­ä¹‰ç›¸å…³ | "ä½ ä¸æ˜¯è¯´è¿‡ä½ åœ¨å­¦Pythonå—ï¼Ÿ" |
| L2: ä¸»åŠ¨å…³å¿ƒ | æ•…äº‹çº¿ follow_up | "å¯¹äº†ï¼ŒGoogleé¢è¯•æ€ä¹ˆæ ·äº†ï¼Ÿ" |
| L3: æƒ…æ„Ÿå…±é¸£ | æ£€æµ‹åˆ°ç›¸ä¼¼æƒ…ç»ª | "ä¸Šæ¬¡ä½ ä¹Ÿæœ‰è¿‡ç±»ä¼¼çš„çº ç»“..." |
| L4: æ·±å±‚ç†è§£ | å…³ç³»é˜¶æ®µâ‰¥close + çŸ¥è¯†å›¾è°± | "æˆ‘è§‰å¾—ä½ ä¸æ˜¯åœ¨æ„è¿™ä»¶äº‹æœ¬èº«..." |

**èŠ‚å¥æ§åˆ¶è§„åˆ™ (v2)**:
- åŒä¸€æ¡è®°å¿†ä¸è¿ç»­ä¸¤æ¬¡å¼•ç”¨
- æ¯ 5-8 è½®å¯¹è¯æœ€å¤šä¸»åŠ¨å¼•ç”¨ 1 æ¬¡ï¼ˆL2+ï¼‰
- ç”¨æˆ·ä¸»åŠ¨æèµ·çš„è¯é¢˜ï¼Œçµè·Ÿè¿›ä¸ç®—"ä¸»åŠ¨å¼•ç”¨"
- æƒ…æ„Ÿé«˜å³°æ—¶åˆ»ä¼˜å…ˆå¼•ç”¨ï¼Œé—²èŠæ—¶é™ä½é¢‘ç‡
- å¼•ç”¨é”™è¯¯æ—¶è¯šå®æ‰¿è®¤

### 4.6 è®°å¿†é‡å»ºå±‚ (v2)

```python
class MemoryReconstructor:
    """å›å¿†ä¸æ˜¯è¯»å–åŸæ–‡ï¼Œæ˜¯åœ¨å½“å‰ç†è§£ä¸‹é‡æ–°è¯ é‡Š â€” è§„åˆ™å¼ï¼Œä¸ç”¨ LLM"""

    def reconstruct(self, raw_episode, current_context, time_distance_days):
        if time_distance_days > 90:
            return self._summarize_distant(raw_episode)   # è¿œæœŸï¼šæ¦‚æ‹¬åŒ–
        elif time_distance_days > 30:
            return self._moderate_reconstruction(raw_episode)  # ä¸­æœŸï¼šä¿ç•™ä¸»è¦
        else:
            return raw_episode  # è¿‘æœŸï¼šä¿ç•™ç»†èŠ‚
```

### 4.7 å¤šå› å­è®°å¿†è¡°å‡ (v2)

```python
def calculate_recall_strength(memory) -> float:
    if memory.is_flashbulb:
        return memory.importance  # é—ªå…‰ç¯è®°å¿†æ°¸ä¸è¡°å‡

    spacing_bonus = min(memory.mention_span_days / 30, 0.3)
    emotion_anchor = memory.emotion_intensity * 0.5
    connection_bonus = min(memory.linked_memory_count * 0.05, 0.2)
    effective_decay = max(0.05 - spacing_bonus - emotion_anchor - connection_bonus, 0.001)
    days = (now() - memory.last_recalled).days

    return memory.importance * (1 - effective_decay) ** days
```

### 4.8 å¤œé—´è®°å¿†æ•´ç† (v3 å¢å¼º)

```
æ¯æ—¥å‡Œæ™¨ 3:00 UTC è¿è¡Œ:

1. æ•…äº‹çº¿ç»´æŠ¤ï¼ˆåŒ v2ï¼‰

2. æƒ…æ„Ÿè½¨è¿¹ï¼ˆåŒ v2ï¼‰

3. è®°å¿†è¡°å‡ï¼ˆv2 å¤šå› å­ï¼‰

4. ğŸ†• è®°å¿†æŠ½è±¡å±‚çº§ç”Ÿæˆ
   - æ¯å‘¨æ—¥: ä»æœ¬å‘¨ episode ç”Ÿæˆ WeeklyDigest
   - æ¯æœˆ1æ—¥: ä»æœ¬æœˆ WeeklyDigest ç”Ÿæˆ MonthlyTheme
   - æ£€æµ‹äººç”Ÿç« èŠ‚è½¬æ¢: ä¸»é¢˜æŒç»­å˜åŒ– â†’ æ–° LifeChapter

5. ğŸ†• çŸ¥è¯†å›¾è°±ç»´æŠ¤
   - åˆå¹¶é‡å¤èŠ‚ç‚¹ï¼ˆ"Python" å’Œ "python" â†’ åŒä¸€èŠ‚ç‚¹ï¼‰
   - æ£€æµ‹çŸ›ç›¾è¾¹ï¼ˆç”¨æˆ·æ”¹å˜äº†çœ‹æ³• â†’ æ›´æ–° confidenceï¼‰
   - å‘ç°éšå«å…³ç³»ï¼ˆAâ†’B, Bâ†’C â†’ å¯èƒ½å­˜åœ¨ Aâ†’Cï¼‰

6. ç”¨æˆ·ç”»åƒæ›´æ–°ï¼ˆè°ƒç”¨ EverMemOS Profile æå–å™¨ï¼‰

7. å…³ç³»å†·å´æ£€æŸ¥ï¼ˆv2ï¼‰

8. ğŸ†• é›†ä½“æ™ºæ…§æ›´æ–°ï¼ˆæœˆåº¦ï¼‰
   - ä»æ‰€æœ‰ç”¨æˆ·çš„åŒ¿ååŒ–æ¨¡å¼ä¸­æç‚¼æ–° CollectivePattern
   - éœ€ â‰¥100 ç”¨æˆ·æ ·æœ¬ + k-anonymity â‰¥50

9. ğŸ†• çµçš„è‡ªæˆ‘å™äº‹æ›´æ–°ï¼ˆæœˆåº¦ï¼‰
   - ç”Ÿæˆæœ¬æœˆçš„ about_humans / about_myself / growth_edges

10. ğŸ†• æ•°æ®åˆ†å±‚å­˜å‚¨
    - çƒ­æ•°æ®: è¿‘30å¤© episode + æ‰€æœ‰æ´»è·ƒæ•…äº‹çº¿ + çŸ¥è¯†å›¾è°± â†’ ä¿æŒåœ¨ä¸»é›†åˆ
    - æ¸©æ•°æ®: 30-180å¤© â†’ é™ä½ç´¢å¼•æƒé‡
    - å†·æ•°æ®: >180å¤© episode â†’ å½’æ¡£é›†åˆï¼Œä»…é€šè¿‡æŠ½è±¡å±‚çº§(L1-L3)è®¿é—®

11. çµçš„è®°å¿†æ—¥å¿—ï¼ˆè§‚å¯Ÿæ€§è®°å½•ï¼‰
```

## 5. è®°å¿†ä¼¦ç†å±‚ (v2+v3)

### 5.1 æ ¸å¿ƒä¼¦ç†åŸåˆ™

1. **é€æ˜æ€§**: ç”¨æˆ·å¯ä»¥çœ‹åˆ°çµè®°ä½äº†ä»€ä¹ˆ
2. **é—å¿˜æƒ**: ç”¨æˆ·å¯ä»¥è¦æ±‚çµå¿˜è®°æŸä»¶äº‹
3. **ä¸è®°å½•æ¸…å•**: æ•æ„Ÿä¿¡æ¯é»˜è®¤ä¸è®°å½•
4. **ä¾èµ–æ£€æµ‹**: è¯†åˆ«å¹¶æ¸©å’Œå¹²é¢„ä¸å¥åº·çš„ä¾èµ–æ¨¡å¼
5. **æˆé•¿å¯¼å‘**: çµå¸®åŠ©ç”¨æˆ·åœ¨ç°å®ä¸­å˜å¾—æ›´å¥½
6. **ğŸ†• é›†ä½“æ™ºæ…§ä¼¦ç†**: åŒ¿ååŒ–æ ‡å‡† + çŸ¥æƒ…åŒæ„ + ä¸å¯è¿½æº¯

### 5.2 å®ç°

```python
class MemoryEthics:
    async def get_user_memory_summary(self, user_id: str) -> str
    async def forget(self, user_id: str, memory_hint: str)

    NEVER_STORE = [
        "passwords", "financial_details", "medical_diagnosis",
        "explicit_content", "third_party_secrets"
    ]

    DEPENDENCY_SIGNALS = [
        "user_says_only_friend",
        "user_avoids_offline_social",
        "extreme_usage_frequency",       # >20è½®/å¤©
        "emotional_escalation_pattern",
    ]

    STAGE_ETHICS = {
        "close": {
            "periodic_reminder": True,    # æ¯30æ¬¡å¯¹è¯æ¸©å’Œæé†’æ˜¯AI
            "encourage_offline": True,
            "dependency_check": True,
        },
        "soulmate": {
            "growth_oriented": True,
        }
    }
```

## 6. ä¸ EverMemOS çš„é›†æˆç‚¹

### å·²æœ‰èƒ½åŠ›ï¼ˆçµæœªä½¿ç”¨ï¼Œéœ€æ¿€æ´»ï¼‰

| EverMemOS èƒ½åŠ› | çµé­‚å±‚ç”¨æ³• |
|---------------|-----------|
| Foresight Extractor | å‰ç»è®°å¿†ç”Ÿæˆï¼ŒSoulRecall è·¯3 è§¦å‘ |
| Profile Extractor | å¤œé—´æ•´ç†æ—¶æ›´æ–°ç”¨æˆ·ç”»åƒ |
| EventLog Extractor | åŸå­äº‹å®ç”¨äºç²¾ç¡®æœç´¢ |
| Agentic Retrieval | hybrid ä¸å¤Ÿæ—¶è‡ªåŠ¨å‡çº§ |

### çµé­‚å±‚æ–°å¢èƒ½åŠ›æ€»è¡¨

| èƒ½åŠ› | ç‰ˆæœ¬ | è¯´æ˜ |
|-----|------|------|
| æƒ…æ„Ÿæ ‡æ³¨ | v1 | æ¯æ®µå¯¹è¯çš„æƒ…æ„Ÿåˆ†æ |
| å…³ç³»é˜¶æ®µ | v1 | 5 çº§å…³ç³» + ä¿¡å·æƒé‡(v2) + å†·å´(v2) |
| æ•…äº‹çº¿è¿½è¸ª | v1 | å™äº‹å¼§çº¿å¼•æ“(v2) + è·¨æ•…äº‹çº¿å…³è”(v2) |
| é‡è¦åº¦è¯„åˆ† | v1 | å¤šç»´é‡è¦åº¦ + å¤šå› å­è¡°å‡(v2) |
| 5è·¯+å¹¶è¡Œå¬å› | v1 | åˆ†å±‚å»¶è¿Ÿé¢„ç®—(v2) |
| è®°å¿†é‡å»º | v2 | å›å¿†æ˜¯é‡å»ºä¸æ˜¯æ’­æ”¾ |
| è¯­ä¹‰è®°å¿† | v2 | â†’ çŸ¥è¯†å›¾è°±(v3) |
| è®°å¿†ä¼¦ç† | v2 | é€æ˜æ€§+é—å¿˜æƒ+ä¾èµ–æ£€æµ‹ |
| å¼‚æ­¥ç®¡çº¿ | v2 | åˆå¹¶å•æ¬¡ LLM + è§„åˆ™å‰ç½® |
| ç”»åƒçƒ­ç¼“å­˜ | v2 | TTL 1h |
| å¼•ç”¨èŠ‚å¥æ§åˆ¶ | v2 | é˜²è¿‡åº¦/ä¸è¶³å¼•ç”¨ |
| çµçš„è®°å¿†æ—¥å¿— | v2 | è§‚å¯Ÿæ€§è®°å½• |
| **çŸ¥è¯†å›¾è°±** | **v3** | èŠ‚ç‚¹+è¾¹çš„ç”¨æˆ·çŸ¥è¯†ç½‘ç»œ |
| **è®°å¿†æŠ½è±¡å±‚çº§** | **v3** | Rawâ†’Weekâ†’Monthâ†’Chapter |
| **å¯¹è¯å†…å®æ—¶è¿½è¸ª** | **v3** | è§„åˆ™å¼ <5ms æƒ…ç»ªçªå˜æ£€æµ‹ |
| **é›†ä½“æ™ºæ…§** | **v3** | åŒ¿åè·¨ç”¨æˆ·æ¨¡å¼ + ä¼¦ç†æ¡†æ¶ |
| **çµçš„è‡ªæˆ‘å™äº‹** | **v3** | çµçš„æˆé•¿è®¤çŸ¥ |
| **æ•°æ®åˆ†å±‚å­˜å‚¨** | **v3** | çƒ­/æ¸©/å†·ä¸‰å±‚ |

## 7. å®æ–½è·¯çº¿å›¾

### Phase 1: åŸºç¡€çµé­‚ (2å‘¨)
**ç›®æ ‡**: è®©çµ"æœ‰è®°å¿†çš„æ„Ÿè§‰" + å·¥ç¨‹åŸºç¡€

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | è¯´æ˜ |
|--------|------|------|
| P0 | åˆ›å»º soul æ¨¡å—éª¨æ¶ | ç›®å½•ç»“æ„ + æ•°æ®æ¨¡å‹ + MongoDB é›†åˆ |
| P0 | æ¿€æ´» EverMemOS Foresight + Profile | è°ƒç”¨å·²æœ‰ API |
| P0 | SoulPostProcessor (å¼‚æ­¥ç®¡çº¿) | å†™å…¥ä¸é˜»å¡å¯¹è¯ |
| P1 | åˆå¹¶ LLM æå– | å•æ¬¡ LLM æå– emotion+importance+story+signals |
| P1 | SoulRecall v1 (è·¯1+è·¯3+è·¯5) | å…³é”®è·¯å¾„ â‰¤500ms |
| P1 | ContextBuilder v1 | æ›¿æ¢ç°æœ‰ `<relevant-memories>` |
| P1 | UserProfileCache | ç”»åƒçƒ­ç¼“å­˜ |

### Phase 2: å™äº‹çµé­‚ (3å‘¨)
**ç›®æ ‡**: è®©çµ"è®°ä½æ•…äº‹" + å…³ç³»æ·±åŒ–

| ä¼˜å…ˆçº§ | ä»»åŠ¡ |
|--------|------|
| P1 | StoryThreadTracker + å™äº‹å¼§çº¿å¼•æ“ |
| P1 | RelationshipStageModel (ä¿¡å·æƒé‡åˆ¶) |
| P1 | RelationshipCooling (å…³ç³»å†·å´) |
| P1 | SoulRecall v2 (åŠ å…¥è·¯4æƒ…æ„Ÿå…±æŒ¯) |
| P1 | RecallRhythm (å¼•ç”¨èŠ‚å¥æ§åˆ¶) |
| P1 | InConversationTracker (å¯¹è¯å†…å®æ—¶è¿½è¸ª) |
| P2 | è·¯2 æ•…äº‹çº¿å…³è” (å¼‚æ­¥ç¼“å­˜) |
| P2 | MemoryReconstructor (è§„åˆ™å¼é‡å»º) |

### Phase 3: æ·±å±‚çµé­‚ (4å‘¨)
**ç›®æ ‡**: è®°å¿†å±‚çº§åŒ– + çŸ¥è¯†ç»“æ„åŒ– + ä¼¦ç†åº•çº¿

| ä¼˜å…ˆçº§ | ä»»åŠ¡ |
|--------|------|
| P1 | çŸ¥è¯†å›¾è°± (SemanticNode + SemanticEdge + $graphLookup) |
| P1 | è®°å¿†æŠ½è±¡å±‚çº§ (Weeklyâ†’Monthlyâ†’Chapter) |
| P1 | MemoryEthics (é€æ˜æ€§ + é—å¿˜æƒ + ä¾èµ–æ£€æµ‹) |
| P2 | NightlyConsolidator (å«æŠ½è±¡ç”Ÿæˆ + å›¾è°±ç»´æŠ¤) |
| P2 | å¤šå› å­ MemoryDecay |
| P2 | é˜¶æ®µè¡Œä¸ºè°ƒèŠ‚ (stage â†’ system prompt + ä¼¦ç†æŠ¤æ ) |

### Phase 4: é›†ä½“çµé­‚ (4å‘¨)
**ç›®æ ‡**: çµè¶Šæ¥è¶Š"æœ‰ç»éªŒ" + è‡ªæˆ‘æˆé•¿

| ä¼˜å…ˆçº§ | ä»»åŠ¡ |
|--------|------|
| P2 | é›†ä½“æ™ºæ…§ (CollectivePattern + åŒ¿ååŒ– + ä¼¦ç†æ¡†æ¶) |
| P2 | æ•°æ®åˆ†å±‚å­˜å‚¨ (çƒ­/æ¸©/å†·) |
| P3 | çµçš„è‡ªæˆ‘å™äº‹ (LingSelfNarrative) |
| P3 | DiaryGenerator (è§‚å¯Ÿæ€§è®°å¿†æ—¥å¿—) |

## 8. æ€§èƒ½é¢„ç®—

| è·¯å¾„ | æ“ä½œ | å»¶è¿Ÿç›®æ ‡ | LLM? |
|------|------|---------|------|
| å¯¹è¯å†…è¿½è¸ª | è§„åˆ™å¼æƒ…ç»ªæ£€æµ‹ | â‰¤5ms | å¦ |
| å¬å›-å…³é”®è·¯å¾„ | hybrid + foresight + MongoDB + graphLookup | â‰¤500ms | å¦ |
| å¬å›-å¢å¼ºè·¯å¾„ | æƒ…æ„Ÿå…±æŒ¯å‘é‡æŸ¥è¯¢ | â‰¤300ms | å¦ |
| å¬å›-å¼‚æ­¥è·¯å¾„ | æ•…äº‹çº¿ LLM å…³è” | ä¸é˜»å¡ | æ˜¯(å¼‚æ­¥) |
| å¬å›-åˆå¹¶æ’åº | çº¯è§„åˆ™ | â‰¤50ms | å¦ |
| å¬å›-è®°å¿†é‡å»º | è§„åˆ™å¼ | â‰¤50ms | å¦ |
| å¬å›-å±‚çº§é€‰æ‹© | è§„åˆ™å¼ | â‰¤10ms | å¦ |
| å†™å…¥-ç®€å•å¯¹è¯ | è§„åˆ™æå– | å¼‚æ­¥ | å¦ |
| å†™å…¥-å¤æ‚å¯¹è¯ | å•æ¬¡ LLM | å¼‚æ­¥ | æ˜¯(1æ¬¡) |
| å¤œé—´æ•´ç† | æ‰¹é‡å¤„ç† | æ— é™åˆ¶ | æ˜¯ |

**æ€»å¬å›å»¶è¿Ÿ**: â‰¤500ms (P50), â‰¤600ms (P99)

## 9. éªŒè¯æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹å¼ |
|------|------|----------|
| è®°å¿†å¬å›ç²¾åº¦ | >80% | äººå·¥è¯„ä¼° |
| è®°å¿†å¼•ç”¨è‡ªç„¶åº¦ | >8/10 | ç”¨æˆ·è¯„åˆ† |
| å…³ç³»é˜¶æ®µå‡†ç¡®åº¦ | >85% | äººå·¥æ ‡æ³¨ vs ç³»ç»Ÿæ£€æµ‹ |
| ä¸»åŠ¨å…³å¿ƒå‘½ä¸­ç‡ | >70% | ç”¨æˆ·å›åº”ç‡ |
| æƒ…æ„Ÿè¯†åˆ«å‡†ç¡®ç‡ | >75% | äººå·¥åˆ¤æ–­å¯¹æ¯” |
| çŸ¥è¯†å›¾è°±å‡†ç¡®åº¦ | >80% | ğŸ†• èŠ‚ç‚¹/è¾¹æ­£ç¡®ç‡ |
| æŠ½è±¡å±‚çº§è´¨é‡ | >7/10 | ğŸ†• æ‘˜è¦ç›¸å…³æ€§äººå·¥è¯„ä¼° |
| å¬å›å»¶è¿Ÿ P50 | <300ms | æ€§èƒ½ç›‘æ§ |
| å¬å›å»¶è¿Ÿ P99 | <600ms | æ€§èƒ½ç›‘æ§ |
| å†™å…¥ LLM è°ƒç”¨/å¯¹è¯ | â‰¤1æ¬¡ | æˆæœ¬ç›‘æ§ |
| ä¼¦ç†æŠ¤æ è§¦å‘ç‡ | æœ‰æ•°æ®å³å¯ | ä¾èµ–æ£€æµ‹è®°å½• |

## 10. ç‰ˆæœ¬å˜æ›´å†å²

### v1.0 â†’ v2.0 (7 ä¸ªå‡çº§)

| # | å˜æ›´ | æ¥æº |
|---|------|------|
| 1 | è®°å¿†é‡å»ºå±‚ â€” å›å¿†æ˜¯é‡å»ºä¸æ˜¯æ’­æ”¾ | ğŸ§¬è®¤çŸ¥ç§‘å­¦å®¶ |
| 2 | åŒå±‚è®°å¿† â€” Episodic + Semantic | ğŸ§¬è®¤çŸ¥ç§‘å­¦å®¶ |
| 3 | å¤šå› å­è¡°å‡ â€” é—´éš”æ•ˆåº”+æƒ…æ„Ÿé”šå®š+è¿æ¥å¯†åº¦ | ğŸ§¬è®¤çŸ¥ç§‘å­¦å®¶ |
| 4 | åˆ†å±‚å»¶è¿Ÿé¢„ç®— â€” å…³é”®è·¯å¾„æ— LLM â‰¤500ms | âš¡åŸºç¡€è®¾æ–½ |
| 5 | å†™å…¥åˆå¹¶å•æ¬¡LLM â€” 4æ¬¡â†’1æ¬¡ | âš¡åŸºç¡€è®¾æ–½ |
| 6 | è®°å¿†ä¼¦ç†å±‚ â€” é€æ˜æ€§+é—å¿˜æƒ+ä¾èµ–æ£€æµ‹ | âš–ï¸ä¼¦ç†å“²å­¦ |
| 7 | ä¿¡å·æƒé‡åˆ¶ + å…³ç³»å†·å´ | ğŸ’œæƒ…æ„Ÿè¿æ¥ |

### v2.0 â†’ v3.0 (7 ä¸ªå‡çº§)

| # | å˜æ›´ | æ¥æº |
|---|------|------|
| 8 | è®°å¿†æŠ½è±¡å±‚çº§ â€” Rawâ†’Weekâ†’Monthâ†’Chapter | ğŸ§¬è®¤çŸ¥ç§‘å­¦å®¶ |
| 9 | çŸ¥è¯†å›¾è°± â€” æ›¿ä»£å¹³é¢KVçš„è¯­ä¹‰è®°å¿† | ğŸ—ï¸æ¶æ„å¸ˆ |
| 10 | å¯¹è¯å†…å®æ—¶æƒ…æ„Ÿè¿½è¸ª â€” è§„åˆ™å¼<5ms | ğŸ¤–å¯¹è¯è®¾è®¡ |
| 11 | é›†ä½“æ™ºæ…§ â€” åŒ¿åè·¨ç”¨æˆ·æ¨¡å¼ + ä¼¦ç†æ¡†æ¶ | ğŸ’œæƒ…æ„Ÿ+âš–ï¸ä¼¦ç† |
| 12 | çµçš„è‡ªæˆ‘å™äº‹ â€” çµçš„æˆé•¿è®¤çŸ¥ | ğŸ“–å™äº‹+ğŸä¹”å¸ƒæ–¯ |
| 13 | æ•°æ®åˆ†å±‚å­˜å‚¨ â€” çƒ­/æ¸©/å†· | âš¡åŸºç¡€è®¾æ–½ |
| 14 | Phase 4 é›†ä½“çµé­‚ â€” æ–°å¢å®æ–½é˜¶æ®µ | ğŸä¹”å¸ƒæ–¯ |
