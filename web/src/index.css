/* === 暗色主题变量 === */
:root {
  /* 基底色 */
  --ling-bg-deep: #0a0015;
  --ling-bg-mid: #0d1b2a;
  --ling-bg-warm: #1a0a2e;

  /* 主题紫 */
  --ling-purple: #8b5cf6;         /* 主色 rgb(139,92,246) */
  --ling-purple-light: #a78bfa;   /* 次色 rgb(167,139,250) */
  --ling-purple-lighter: #c4b5fd; /* 浅紫 */
  --ling-purple-deep: #6d28d9;    /* 深紫 */
  --ling-purple-text: #e2d4ff;    /* 紫调文字 */

  /* 表面/容器 */
  --ling-surface: rgba(255, 255, 255, 0.06);
  --ling-surface-hover: rgba(255, 255, 255, 0.1);
  --ling-surface-border: rgba(255, 255, 255, 0.08);
  --ling-surface-elevated: rgba(0, 0, 0, 0.35);

  /* 文字 */
  --ling-text-primary: rgba(255, 255, 255, 0.95);
  --ling-text-secondary: rgba(255, 255, 255, 0.8);
  --ling-text-tertiary: rgba(255, 255, 255, 0.45);
  --ling-text-muted: rgba(255, 255, 255, 0.35);

  /* 语义色 */
  --ling-success: #4ade80;
  --ling-warning: #fbbf24;
  --ling-error: #f87171;
  --ling-error-bg: rgba(248, 113, 113, 0.2);
  --ling-error-border: rgba(248, 113, 113, 0.3);

  /* 紫色常用透明度 */
  --ling-purple-15: rgba(139, 92, 246, 0.15);
  --ling-purple-20: rgba(139, 92, 246, 0.2);
  --ling-purple-25: rgba(139, 92, 246, 0.25);
  --ling-purple-30: rgba(139, 92, 246, 0.3);
  --ling-purple-40: rgba(139, 92, 246, 0.4);
  --ling-purple-50: rgba(139, 92, 246, 0.5);
  --ling-purple-60: rgba(139, 92, 246, 0.6);
  --ling-purple-70: rgba(139, 92, 246, 0.7);
  --ling-purple-85: rgba(139, 92, 246, 0.85);

  /* 气泡 */
  --ling-bubble-user-bg: linear-gradient(135deg, rgba(139, 92, 246, 0.62), rgba(109, 40, 217, 0.54));
  --ling-bubble-ai-bg: rgba(255, 255, 255, 0.15);
  --ling-bubble-user-border: rgba(139, 92, 246, 0.4);
  --ling-bubble-ai-border: rgba(255, 255, 255, 0.22);
  --ling-bubble-ai-accent: rgba(139, 92, 246, 0.78);
  --ling-bubble-user-shadow: rgba(139, 92, 246, 0.30);
  --ling-bubble-user-text: rgba(255, 255, 255, 0.97);
  --ling-bubble-ai-shadow: rgba(0, 0, 0, 0.22);
  --ling-bubble-ai-text: rgba(255, 255, 255, 0.92);
  --ling-chat-timestamp: rgba(255, 255, 255, 0.5);
  --ling-chat-label: var(--ling-purple-70);
  --ling-chat-label-user: rgba(255, 255, 255, 0.68);
  --ling-avatar-user-bg: rgba(139, 92, 246, 0.44);
  --ling-avatar-user-color: rgba(255, 255, 255, 0.9);
  --ling-avatar-ai-bg: rgba(139, 92, 246, 0.18);
  --ling-avatar-ai-color: rgba(167, 139, 250, 0.9);
  --ling-collapse-mask-ai: linear-gradient(transparent, rgba(255, 255, 255, 0.08));
  --ling-collapse-mask-user: linear-gradient(transparent, rgba(109, 40, 217, 0.5));

  /* 代码块 */
  --ling-code-text: #c4b5fd;
  --ling-code-bg: rgba(10, 0, 21, 0.6);

  /* 微透明叠加（代码块头、表格斑马纹、滚动条轨道等） */
  --ling-overlay-4: rgba(255, 255, 255, 0.04);
  --ling-overlay-8: rgba(255, 255, 255, 0.08);
  --ling-overlay-12: rgba(255, 255, 255, 0.12);
  --ling-stripe-bg: rgba(255, 255, 255, 0.02);

  /* 全局背景（供 body 引用） */
  --ling-body-bg: linear-gradient(180deg, var(--ling-bg-deep) 0%, var(--ling-bg-mid) 50%, var(--ling-bg-warm) 100%);
  --ling-body-color: #ffffff;
  --ling-placeholder-color: rgba(255, 255, 255, 0.4);
  --ling-selection-color: #fff;
  --ling-md-em: rgba(200, 180, 255, 0.9);
  --ling-md-pre-code: rgba(255, 255, 255, 0.85);
  --ling-md-blockquote-color: rgba(255, 255, 255, 0.7);
  --ling-md-heading-color: rgba(255, 255, 255, 0.95);

  /* 输入栏（InputBar 内联样式引用） */
  --ling-input-bar-bg: rgba(255, 255, 255, 0.03);
  --ling-input-hover-border: rgba(255, 255, 255, 0.18);
  --ling-input-hover-bg: rgba(255, 255, 255, 0.08);
  --ling-input-hint: rgba(255, 255, 255, 0.2);
  --ling-input-counter: rgba(255, 255, 255, 0.25);
  --ling-input-counter-warn: rgba(251, 191, 36, 0.7);
  --ling-btn-muted-bg: rgba(255, 255, 255, 0.06);
  --ling-btn-muted-border: rgba(255, 255, 255, 0.08);
  --ling-btn-muted-color: rgba(255, 255, 255, 0.5);
}

/* === 亮色主题变量 === */
[data-theme="light"] {
  /* 基底色 */
  --ling-bg-deep: #f5f0ff;
  --ling-bg-mid: #ede5ff;
  --ling-bg-warm: #e8deff;

  /* 主题紫（保持不变，仅微调对比度） */
  --ling-purple: #7c3aed;
  --ling-purple-light: #8b5cf6;
  --ling-purple-lighter: #a78bfa;
  --ling-purple-deep: #6d28d9;
  --ling-purple-text: #4c1d95;

  /* 表面/容器 */
  --ling-surface: rgba(0, 0, 0, 0.04);
  --ling-surface-hover: rgba(0, 0, 0, 0.07);
  --ling-surface-border: rgba(0, 0, 0, 0.1);
  --ling-surface-elevated: rgba(255, 255, 255, 0.8);

  /* 文字 */
  --ling-text-primary: rgba(0, 0, 0, 0.9);
  --ling-text-secondary: rgba(0, 0, 0, 0.65);
  --ling-text-tertiary: rgba(0, 0, 0, 0.4);
  --ling-text-muted: rgba(0, 0, 0, 0.35);

  /* 语义色 */
  --ling-success: #16a34a;
  --ling-warning: #d97706;
  --ling-error: #dc2626;
  --ling-error-bg: rgba(220, 38, 38, 0.1);
  --ling-error-border: rgba(220, 38, 38, 0.2);

  /* 紫色常用透明度 */
  --ling-purple-15: rgba(124, 58, 237, 0.12);
  --ling-purple-20: rgba(124, 58, 237, 0.16);
  --ling-purple-25: rgba(124, 58, 237, 0.2);
  --ling-purple-30: rgba(124, 58, 237, 0.25);
  --ling-purple-40: rgba(124, 58, 237, 0.3);
  --ling-purple-50: rgba(124, 58, 237, 0.4);
  --ling-purple-60: rgba(124, 58, 237, 0.5);
  --ling-purple-70: rgba(124, 58, 237, 0.6);
  --ling-purple-85: rgba(124, 58, 237, 0.75);

  /* 气泡 */
  --ling-bubble-user-bg: linear-gradient(135deg, rgba(124, 58, 237, 0.52), rgba(109, 40, 217, 0.42));
  --ling-bubble-ai-bg: rgba(255, 255, 255, 0.68);
  --ling-bubble-user-border: rgba(124, 58, 237, 0.45);
  --ling-bubble-ai-border: rgba(124, 58, 237, 0.24);
  --ling-bubble-ai-accent: rgba(124, 58, 237, 0.5);
  --ling-bubble-user-shadow: rgba(124, 58, 237, 0.22);
  --ling-bubble-user-text: rgba(255, 255, 255, 0.97);
  --ling-bubble-ai-shadow: rgba(0, 0, 0, 0.06);
  --ling-bubble-ai-text: rgba(0, 0, 0, 0.85);
  --ling-chat-timestamp: rgba(0, 0, 0, 0.4);
  --ling-chat-label: var(--ling-purple-60);
  --ling-chat-label-user: rgba(0, 0, 0, 0.58);
  --ling-avatar-user-bg: rgba(124, 58, 237, 0.30);
  --ling-avatar-user-color: rgba(255, 255, 255, 0.95);
  --ling-avatar-ai-bg: rgba(124, 58, 237, 0.18);
  --ling-avatar-ai-color: rgba(124, 58, 237, 0.75);
  --ling-collapse-mask-ai: linear-gradient(transparent, rgba(255, 255, 255, 0.6));
  --ling-collapse-mask-user: linear-gradient(transparent, rgba(124, 58, 237, 0.32));

  /* 代码块 */
  --ling-code-text: #6d28d9;
  --ling-code-bg: rgba(124, 58, 237, 0.08);

  /* 微透明叠加 */
  --ling-overlay-4: rgba(0, 0, 0, 0.04);
  --ling-overlay-8: rgba(0, 0, 0, 0.06);
  --ling-overlay-12: rgba(0, 0, 0, 0.08);
  --ling-stripe-bg: rgba(0, 0, 0, 0.03);

  /* 全局背景 */
  --ling-body-bg: linear-gradient(180deg, var(--ling-bg-deep) 0%, var(--ling-bg-mid) 50%, var(--ling-bg-warm) 100%);
  --ling-body-color: #1a1a2e;
  --ling-placeholder-color: rgba(0, 0, 0, 0.35);
  --ling-selection-color: #1a1a2e;
  --ling-md-em: rgba(109, 40, 217, 0.85);
  --ling-md-pre-code: rgba(0, 0, 0, 0.75);
  --ling-md-blockquote-color: rgba(0, 0, 0, 0.6);
  --ling-md-heading-color: rgba(0, 0, 0, 0.9);

  /* 输入栏 */
  --ling-input-bar-bg: rgba(0, 0, 0, 0.02);
  --ling-input-hover-border: rgba(124, 58, 237, 0.25);
  --ling-input-hover-bg: rgba(0, 0, 0, 0.06);
  --ling-input-hint: rgba(0, 0, 0, 0.25);
  --ling-input-counter: rgba(0, 0, 0, 0.3);
  --ling-input-counter-warn: rgba(217, 119, 6, 0.75);
  --ling-btn-muted-bg: rgba(0, 0, 0, 0.04);
  --ling-btn-muted-border: rgba(0, 0, 0, 0.1);
  --ling-btn-muted-color: rgba(0, 0, 0, 0.4);
}

/* === 全局基础 === */
html {
  background: var(--ling-bg-deep) !important;
}
body, html {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: var(--ling-body-bg) !important;
  min-height: 100vh;
  min-height: -webkit-fill-available;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans SC', 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', sans-serif;
  color: var(--ling-body-color);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* 防止 iOS 橡皮筋滚动 */
body {
  position: fixed;
  width: 100%;
  height: 100%;
  touch-action: manipulation;
}

/* === 滚动条 === */
::-webkit-scrollbar {
  width: 4px;
  height: 4px;
}
::-webkit-scrollbar-track {
  background: transparent;
}
::-webkit-scrollbar-thumb {
  background: var(--ling-purple-30);
  border-radius: 2px;
}
::-webkit-scrollbar-thumb:hover {
  background: var(--ling-purple-50);
}

/* === 动画 === */
@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes pageFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideInRight {
  from { opacity: 0; transform: translateX(20px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes slideOutRight {
  from { opacity: 1; transform: translateX(0); }
  to { opacity: 0; transform: translateX(20px); }
}

/* Memory panel custom scrollbar */
.ling-memory-scroll::-webkit-scrollbar { width: 4px; }
.ling-memory-scroll::-webkit-scrollbar-track { background: transparent; }
.ling-memory-scroll::-webkit-scrollbar-thumb {
  background: rgba(139, 92, 246, 0.25);
  border-radius: 4px;
}
.ling-memory-scroll::-webkit-scrollbar-thumb:hover {
  background: rgba(139, 92, 246, 0.4);
}
/* Memory card focus-within for keyboard users */
.ling-memory-card:focus-within {
  background: rgba(255,255,255,0.07);
  border-left-color: rgba(139,92,246,0.55);
}

/* Right toolbar action buttons hover */
.ling-action-btn:hover {
  background: rgba(255, 255, 255, 0.14) !important;
  border-color: rgba(255, 255, 255, 0.2) !important;
}
.ling-action-btn[data-active="true"]:hover {
  background: rgba(139, 92, 246, 0.5) !important;
  border-color: rgba(139, 92, 246, 0.7) !important;
}

@keyframes landingBtnSpin {
  to { transform: rotate(360deg); }
}

/* Landing — GPU-friendly glow breathing via opacity-only animation on ::after */
@keyframes breatheGlowOpacity {
  0%, 100% { opacity: 0; }
  50% { opacity: 1; }
}

.landing-start-btn::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  box-shadow: 0 0 45px var(--ling-purple-60), 0 0 90px var(--ling-purple-30);
  opacity: 0;
  animation: breatheGlowOpacity 3s ease-in-out infinite;
  pointer-events: none;
  will-change: opacity;
  transition: opacity 0.25s ease;
}
.landing-start-btn:not(:disabled):hover {
  transform: scale(1.06);
}
.landing-start-btn:not(:disabled):hover .landing-btn-arrow {
  transform: translateX(4px);
}
.landing-start-btn:not(:disabled):active {
  transform: scale(0.97);
  transition-duration: 0.1s;
}
.landing-start-btn:not(:disabled):hover::after {
  opacity: 1;
  animation: none;
}
.landing-start-btn:focus-visible {
  outline: 2px solid var(--ling-purple-lighter);
  outline-offset: 3px;
}

/* Landing 始终暗色主题——覆盖 [data-theme="light"] 的变量继承 */
[data-landing] {
  --ling-bg-deep: #0a0015;
  --ling-bg-mid: #0d1b2a;
  --ling-bg-warm: #1a0a2e;
  --ling-purple: #8b5cf6;
  --ling-purple-deep: #6d28d9;
  --ling-purple-lighter: #c4b5fd;
  --ling-purple-text: #e2d4ff;
  --ling-purple-20: rgba(139, 92, 246, 0.2);
  --ling-purple-30: rgba(139, 92, 246, 0.3);
  --ling-purple-40: rgba(139, 92, 246, 0.4);
  --ling-purple-60: rgba(139, 92, 246, 0.6);
  --ling-text-secondary: rgba(255, 255, 255, 0.8);
  --ling-purple-25: rgba(139, 92, 246, 0.25);
  --ling-text-tertiary: rgba(255, 255, 255, 0.45);
  --ling-text-muted: rgba(255, 255, 255, 0.35);
}

/* Landing text line */
.landing-text-line {
  position: relative;
}

/* Landing title — breathing glow after typewriter completes
 * GPU-friendly: static text-shadow (painted once) + opacity-only animated pseudo-element.
 * Replaces per-frame text-shadow animation that triggered full repaints. */
.landing-title-glow {
  text-shadow: 0 0 40px var(--ling-purple-40), 0 0 80px var(--ling-purple-20);
}
.landing-title-glow::before {
  content: '';
  position: absolute;
  inset: -40px -20px;
  border-radius: 50%;
  background: radial-gradient(ellipse at center, var(--ling-purple-40) 0%, var(--ling-purple-20) 40%, transparent 70%);
  opacity: 0;
  animation: breatheGlowOpacity 4s ease-in-out infinite;
  will-change: opacity;
  pointer-events: none;
  z-index: -1;
}

/* Landing title — gradient text with subtle shimmer sweep */
.landing-title-gradient {
  background: linear-gradient(
    90deg,
    #fff 0%, #e2d4ff 15%, #c4b5fd 30%, #a78bfa 45%,
    #fff 50%,
    #a78bfa 55%, #c4b5fd 70%, #e2d4ff 85%, #fff 100%
  );
  background-size: 200% 100%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: textShimmer 6s ease-in-out 1s infinite both;
}
@keyframes textShimmer {
  0%, 40% { background-position: 100% center; }
  60%, 100% { background-position: -100% center; }
}

/* Landing feature pills */
.landing-feature-pills {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: center;
}
/* Landing hint — CSS media query instead of JS layout read */
.landing-hint-mobile { display: none; }
.landing-hint-desktop { display: inline; }

.landing-feature-pill {
  padding: 4px 14px;
  font-size: 0.7rem;
  color: var(--ling-text-tertiary);
  border: 1px solid var(--ling-purple-20);
  border-radius: 999px;
  letter-spacing: 0.04em;
  white-space: nowrap;
}

@keyframes skeletonPulse {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 0.8; }
}

@keyframes skeletonOrb {
  0%, 100% { transform: scale(0.95); opacity: 0.3; }
  50% { transform: scale(1.05); opacity: 0.6; }
}

@keyframes skeletonBarShimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(200%); }
}

/* AI indicator — GPU-friendly glow via opacity-only animation on ::after (avoids per-frame box-shadow repaint) */
@keyframes indicatorBreatheOpacity {
  0%, 100% { opacity: 0; }
  50% { opacity: 1; }
}
.ling-ai-indicator {
  position: relative;
}
.ling-ai-indicator::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  box-shadow: 0 0 20px rgba(139, 92, 246, 0.5), 0 2px 12px rgba(0, 0, 0, 0.25);
  opacity: 0;
  animation: indicatorBreatheOpacity 3s ease-in-out infinite;
  pointer-events: none;
  will-change: opacity;
}

/* ConnectionStatus — CSS hover instead of JS DOM manipulation */
.ling-conn-closed {
  transition: background 0.15s ease, border-color 0.15s ease;
}
.ling-conn-closed:hover {
  background: var(--ling-surface-elevated) !important;
  border-color: var(--ling-error) !important;
}

/* ConnectionStatus — keyframe animations (core always-rendered component) */
@keyframes connFadeIn {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 0.7; transform: translateY(0); }
}
@keyframes connFadeOut {
  from { opacity: 0.7; transform: translateY(0); }
  to { opacity: 0; transform: translateY(-4px); }
}
@keyframes connPulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.4; transform: scale(0.8); }
}

/* InputBar — textarea, buttons, and animation styles (core always-rendered component) */
@keyframes inputPulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}
@keyframes micPulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
  50% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
}
@keyframes sendSpin {
  to { transform: rotate(360deg); }
}
@keyframes inputShake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-4px); }
  50% { transform: translateX(4px); }
  75% { transform: translateX(-2px); }
}
.ling-textarea {
  background: var(--ling-btn-muted-bg);
  border: 1px solid var(--ling-btn-muted-border);
  border-radius: 16px;
  color: var(--ling-text-primary);
  font-size: 14px;
  padding: 10px 16px;
  min-height: 42px;
  max-height: 96px;
  resize: none;
  flex: 1;
  outline: none;
  font-family: inherit;
  line-height: 1.5;
  transition: border-color 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
}
.ling-textarea::placeholder {
  color: var(--ling-placeholder-color);
  transition: color 0.2s ease;
}
.ling-textarea:hover:not(:focus):not(:disabled) {
  border-color: var(--ling-input-hover-border);
  background: var(--ling-input-hover-bg);
}
.ling-textarea:focus {
  border-color: var(--ling-purple-50);
  box-shadow: 0 0 0 1px var(--ling-purple-25), 0 0 16px var(--ling-purple-15);
  background: var(--ling-input-hover-bg);
}
.ling-textarea:focus::placeholder {
  color: var(--ling-text-muted);
}
.ling-textarea:disabled {
  opacity: 0.45;
  cursor: not-allowed;
}
.ling-send-btn:not(:disabled):hover {
  filter: brightness(1.15);
}
.ling-send-btn:not(:disabled):active {
  transform: scale(0.88);
}
.ling-mic-btn:hover {
  filter: brightness(1.15);
}
.ling-mic-btn:active {
  transform: scale(0.88);
}
/* Light theme: darken-on-hover instead of brighten (buttons are already light) */
[data-theme="light"] .ling-send-btn:not(:disabled):hover {
  filter: brightness(0.92);
}
[data-theme="light"] .ling-mic-btn:hover {
  filter: brightness(0.92);
}
.ling-textarea.ling-shake {
  animation: inputShake 0.35s ease;
  border-color: rgba(239, 68, 68, 0.4) !important;
  box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.15) !important;
}

/* Language switcher option buttons */
.ling-lang-option:not([aria-selected="true"]):hover {
  background: rgba(255, 255, 255, 0.08);
  color: rgba(255, 255, 255, 0.85);
}
.ling-lang-option:focus-visible {
  outline: 2px solid rgba(139, 92, 246, 0.6);
  outline-offset: -2px;
}
[data-theme="light"] .ling-lang-option:not([aria-selected="true"]):hover {
  background: rgba(139, 92, 246, 0.1);
  color: rgba(0, 0, 0, 0.85);
}

/* Live2D 点击粒子 */
@keyframes tapParticleFloat {
  0% { opacity: 1; transform: translateY(0) translateX(0) scale(1); }
  70% { opacity: 1; }
  100% { opacity: 0; transform: translateY(-90px) translateX(var(--drift, 0px)) scale(0.4); }
}
.ling-tap-particle {
  animation: tapParticleFloat 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  will-change: transform, opacity;
  filter: drop-shadow(0 0 4px rgba(139, 92, 246, 0.5));
  user-select: none;
}

/* === 选择样式 === */
::selection {
  background: var(--ling-purple-30);
  color: var(--ling-selection-color);
}

/* === 输入框 placeholder === */
input::placeholder, textarea::placeholder {
  color: var(--ling-placeholder-color);
}

/* === 聚焦环 === */
*:focus-visible {
  outline: 2px solid var(--ling-purple-50);
  outline-offset: 2px;
}

/* === Canvas 层 === */
canvas {
  display: block;
}

/* === 移动端触摸优化 === */
@media (max-width: 768px) {
  /* 长文本气泡在移动端更宽，避免 500+ 字消息过窄过高 */
  .chat-msg-inner {
    max-width: 90% !important;
  }

  /* 禁止长按选择 */
  * {
    -webkit-touch-callout: none;
  }

  /* 输入框在移动端不缩放 */
  input, textarea {
    font-size: 16px !important; /* 防止 iOS 自动缩放 */
  }


  /* 代码块限高——移动端避免出现过高的滚动区 */
  .md-content .code-block-wrap pre {
    max-height: 350px;
  }

  /* Landing 动画移动端优化 */
  .landing-text-line {
    font-size: 15px !important;
    line-height: 1.5 !important;
  }
  .landing-text-line:first-child {
    font-size: 26px !important;
    min-height: 2.5rem !important; /* override inline 4.5rem — proportional to 26px mobile font */
    letter-spacing: 0.08em !important; /* tighter than desktop 0.12em */
  }
  .landing-text-line:nth-child(2) {
    font-size: 17px !important;
  }
  .landing-start-btn {
    padding: 16px 40px !important;
    font-size: 16px !important;
    min-height: 48px !important;
  }
  .landing-hint-mobile { display: inline; }
  .landing-hint-desktop { display: none; }
}

/* === Markdown 内容（AI 气泡） === */
.md-content {
  word-break: break-word; /* fallback for older WebViews that lack overflow-wrap:anywhere */
  overflow-wrap: anywhere;
  min-width: 0;
}
.md-content p { margin: 0 0 0.85em; }
.md-content p:last-child { margin-bottom: 0; }
.md-content strong { color: var(--ling-text-primary); }
.md-content em { color: var(--ling-md-em); }
.md-content del { color: var(--ling-text-tertiary); }
.md-content a, .user-msg-link { color: var(--ling-purple-light); text-decoration: none; border-bottom: 1px solid rgba(167,139,250,0.3); transition: border-color 0.2s; overflow-wrap: anywhere; }
.md-content a:hover, .user-msg-link:hover { border-color: var(--ling-purple-light); }
.md-content img { max-width: 100%; height: auto; border-radius: 8px; }
.md-content code {
  background: var(--ling-purple-15);
  color: var(--ling-code-text);
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.9em;
  font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', monospace;
  overflow-wrap: anywhere;
  -webkit-box-decoration-break: clone;
  box-decoration-break: clone;
}
/* Code block wrapper — base styles for all contexts (nested in blockquotes, lists, etc.) */
.md-content .code-block-wrap {
  position: relative;
  margin: 0.5em 0;
  border: 1px solid var(--ling-purple-25);
  border-radius: 6px;
  overflow: hidden;
  background: var(--ling-code-bg);
}
/* Full-bleed to bubble edges — top-level code blocks only */
.md-content > .code-block-wrap {
  margin-left: -18px;
  margin-right: -18px;
  border-left: none;
  border-right: none;
  border-radius: 0;
}
/* Tighter vertical spacing when code block is at message boundary */
.md-content > .code-block-wrap:first-child { margin-top: -4px; }
.md-content > .code-block-wrap:last-child { margin-bottom: -4px; }
.md-content .code-block-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 16px;
  background: var(--ling-overlay-4);
  border-bottom: 1px solid var(--ling-purple-15);
  min-height: 28px;
}
.md-content .code-block-lang {
  font-size: 11px;
  font-weight: 500;
  color: var(--ling-text-tertiary);
  letter-spacing: 0.3px;
  user-select: none;
}
.md-content .code-block-copy {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  margin-left: auto;
  background: transparent;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  padding: 0;
  color: var(--ling-text-tertiary);
  transition: color 0.15s, background 0.15s, transform 0.15s;
}
.md-content .code-block-copy:hover {
  color: var(--ling-text-secondary);
  background: var(--ling-overlay-8);
}
.md-content .code-block-copy:active {
  transform: scale(0.88);
  color: var(--ling-text-secondary);
  background: var(--ling-overlay-12);
}
.md-content .code-block-wrap pre {
  margin: 0;
  border: none;
  border-radius: 0;
  background: transparent;
  padding: 10px 16px;
  overflow: auto;
  max-height: 500px;
  line-height: 1.5;
  scrollbar-width: thin;
  scrollbar-color: var(--ling-purple-40) transparent;
}
.md-content .code-block-wrap pre::-webkit-scrollbar {
  height: 6px;
  width: 6px;
}
.md-content .code-block-wrap pre::-webkit-scrollbar-track {
  background: var(--ling-overlay-4);
  border-radius: 3px;
}
.md-content .code-block-wrap pre::-webkit-scrollbar-thumb {
  background: var(--ling-purple-40);
  border-radius: 3px;
}
/* Standalone pre (no wrapper) — fallback */
.md-content pre:not(.code-block-wrap pre) {
  background: var(--ling-code-bg);
  border: 1px solid var(--ling-purple-25);
  border-radius: 8px;
  padding: 10px 14px;
  overflow: auto;
  max-height: 500px;
  line-height: 1.5;
  margin: 0.5em 0;
}
.md-content pre code {
  background: none;
  padding: 0;
  font-size: 0.85em;
  color: var(--ling-md-pre-code);
  word-break: normal;
  overflow-wrap: normal;
  overflow: visible;
}
.md-content ul, .md-content ol { margin: 0.6em 0; padding-left: 1.5em; }
.md-content li > ul, .md-content li > ol { margin: 0.2em 0; }
.md-content li { margin-bottom: 0.35em; }
.md-content blockquote {
  margin: 0.75em 0;
  padding: 6px 14px;
  border-left: 3px solid var(--ling-purple-40);
  background: var(--ling-overlay-4);
  border-radius: 0 6px 6px 0;
  color: var(--ling-md-blockquote-color);
}
.md-content h1, .md-content h2, .md-content h3,
.md-content h4, .md-content h5, .md-content h6 {
  margin: 1em 0 0.5em;
  color: var(--ling-md-heading-color);
  font-weight: 600;
}
.md-content > :first-child { margin-top: 0; }
.md-content > :last-child { margin-bottom: 0; }
.md-content h1 { font-size: 1.3em; }
.md-content h2 { font-size: 1.15em; }
.md-content h3 { font-size: 1.05em; }
/* GFM task list (checkbox) */
.md-content input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  border: 1.5px solid var(--ling-purple-40);
  border-radius: 3px;
  background: transparent;
  vertical-align: middle;
  margin: 0 6px 0 0;
  position: relative;
  cursor: default;
}
.md-content input[type="checkbox"]:checked {
  background: var(--ling-purple);
  border-color: var(--ling-purple);
}
.md-content input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 3px;
  top: 0.5px;
  width: 5px;
  height: 8px;
  border: solid #fff;
  border-width: 0 1.5px 1.5px 0;
  transform: rotate(45deg);
}
.md-content li:has(> input[type="checkbox"]) {
  list-style: none;
  margin-left: -1.5em;
}
.md-content hr {
  border: none;
  border-top: 1px solid var(--ling-purple-15);
  margin: 0.6em 0;
}
/* Table — scrollable wrapper to prevent bubble overflow */
.md-content table {
  display: block;
  overflow-x: auto;
  max-width: 100%;
  border-collapse: collapse;
  margin: 0.5em 0;
  font-size: 0.9em;
  scrollbar-width: thin;
  scrollbar-color: var(--ling-purple-40) transparent;
}
.md-content table::-webkit-scrollbar { height: 6px; }
.md-content table::-webkit-scrollbar-track { background: var(--ling-overlay-4); border-radius: 3px; }
.md-content table::-webkit-scrollbar-thumb { background: var(--ling-purple-40); border-radius: 3px; }
.md-content th, .md-content td {
  padding: 6px 12px;
  border: 1px solid var(--ling-purple-25);
}
.md-content td {
  overflow-wrap: break-word;
}
.md-content th {
  background: var(--ling-overlay-4);
  font-weight: 600;
  color: var(--ling-md-heading-color);
  white-space: nowrap;
}
.md-content tr:nth-child(even) {
  background: var(--ling-stripe-bg);
}

/* === Chat pipeline — animations & interaction styles ===
 * Moved from runtime createStyleInjector to static CSS.
 * Previously each component injected its own <style> on first mount,
 * costing 5 useEffect hooks and ~3KB of JS-embedded CSS strings. */

/* ── ChatArea: container, welcome state, scroll-to-bottom ── */
.chat-area-scroll::-webkit-scrollbar { width: 4px; }
.chat-area-scroll::-webkit-scrollbar-track { background: transparent; }
.chat-area-scroll::-webkit-scrollbar-thumb { background: var(--ling-purple-30); border-radius: 2px; }
@keyframes chatFadeInUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
@keyframes emptyItemFadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes emptyHintFadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 0.6; transform: translateY(0); } }
@keyframes emptyStateFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
@keyframes emptyStateFadeOut { from { opacity: 1; transform: translateY(0) scale(1); } to { opacity: 0; transform: translateY(-12px) scale(0.96); } }
@keyframes scrollBtnIn { from { opacity: 0; transform: translateY(12px) scale(0.8); } to { opacity: 1; transform: translateY(0) scale(1); } }
@keyframes scrollBtnPulse { 0%, 100% { opacity: 0.85; } 50% { opacity: 1; } }
@keyframes chipFadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
@keyframes greetingBubbleIn { from { opacity: 0; transform: translateY(16px) scale(0.97); } to { opacity: 1; transform: translateY(0) scale(1); } }
.welcome-chip { transition: background 0.2s ease, border-color 0.2s ease, transform 0.2s ease; }
.welcome-chip:hover { background: var(--ling-purple-25) !important; border-color: var(--ling-purple-30) !important; transform: translateY(-1px); }
.welcome-chip:active { transform: scale(0.97); }
.chat-msg-item { contain: layout paint style; }

/* ── ChatBubble: message entry, copy button, timestamps ── */
@keyframes bubbleFadeInUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
@keyframes streamingCursor { 0%, 100% { opacity: 1; } 50% { opacity: 0.15; } }
@keyframes bubbleCopyFlash { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(0.97); opacity: 0.7; } 100% { transform: scale(1); opacity: 1; } }
.chat-copy-btn { opacity: 0; }
.chat-bubble-wrap:hover .chat-copy-btn { opacity: 1; }
.chat-copy-btn:hover { color: var(--ling-text-secondary) !important; background: var(--ling-surface) !important; }
.chat-copy-btn:active { transform: scale(0.88); color: var(--ling-text-secondary) !important; background: var(--ling-surface-hover) !important; }
.chat-bubble-ts { opacity: 0; transition: opacity 0.2s ease; }
.ling-msg-row:hover .chat-bubble-ts { opacity: 1; }
@media (hover: none) { .chat-copy-btn { opacity: 0.5; } .chat-bubble-ts { opacity: 0.7; } }
@media (max-width: 768px) { .chat-copy-btn { right: 4px !important; left: auto !important; top: -24px !important; } }
@media (max-width: 480px) { .ling-avatar { display: none !important; } }

/* ── ThinkingBubble: streaming entry, text fade ── */
@keyframes thinkingBubbleIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
@keyframes textFadeIn { from { opacity: 0; } to { opacity: 1; } }

/* ── TypingIndicator: thinking dots ── */
@keyframes typingFadeInUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
@keyframes thinkingDot { 0%, 80%, 100% { opacity: 0.35; transform: translateY(0) scale(0.85); } 40% { opacity: 1; transform: translateY(-6px) scale(1.1); } }
@keyframes thinkingPulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); } 50% { box-shadow: 0 0 12px 2px rgba(139, 92, 246, 0.08); } }
@keyframes thinkingFadeOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.92); } }

/* ── ToolResultCard: tool call visualization ── */
.tool-code-scroll::-webkit-scrollbar { height: 3px; }
.tool-code-scroll::-webkit-scrollbar-thumb { background: var(--ling-purple-30); border-radius: 2px; }
@keyframes toolShimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(200%); } }
@keyframes toolPulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }
@keyframes toolStatusPop { 0% { transform: scale(0.6); opacity: 0; } 60% { transform: scale(1.15); } 100% { transform: scale(1); opacity: 1; } }
@keyframes toolContentReveal { from { opacity: 0; transform: translateY(-4px); } to { opacity: 1; transform: translateY(0); } }

/* === Eagerly-loaded component keyframes ===
 * Moved from runtime createStyleInjector to static CSS (same pattern
 * as the chat pipeline migration above). Eliminates 5 useEffect hooks
 * and ~3KB of JS-embedded CSS strings from the initial bundle. */

/* ── BackgroundReactor: AI activity glow & affinity ambient ── */
@keyframes bgThinkingPulse {
  0%, 100% { opacity: calc(0.5 * var(--bg-glow-boost, 1)); }
  50% { opacity: calc(0.7 * var(--bg-glow-boost, 1)); }
}
@keyframes bgWorkingFlow {
  0%, 100% { opacity: calc(0.55 * var(--bg-glow-boost, 1)); transform: scale(1); }
  50% { opacity: calc(0.7 * var(--bg-glow-boost, 1)); transform: scale(1.02); }
}
@keyframes bgAiThinkingBreathe {
  0%, 100% { opacity: calc(0.35 * var(--bg-glow-boost, 1)); transform: scale(1); }
  50% { opacity: calc(0.5 * var(--bg-glow-boost, 1)); transform: scale(1.01); }
}
@keyframes bgWorkingSpin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes bgPresentingRays {
  0% { opacity: 0; transform: scale(0.8); }
  30% { opacity: 0.6; transform: scale(1.05); }
  100% { opacity: 0.3; transform: scale(1.2); }
}
@keyframes completionBloom {
  0% { opacity: 0; transform: scale(0.5); }
  20% { opacity: 0.8; transform: scale(1); }
  100% { opacity: 0; transform: scale(1.5); }
}
@keyframes completionFlash {
  0% { opacity: 0; }
  15% { opacity: 0.8; }
  100% { opacity: 0; }
}
@keyframes bgAffinityBreathe {
  0%, 100% { opacity: var(--affinity-idle-opacity, 0.1); }
  50% { opacity: calc(var(--affinity-idle-opacity, 0.1) * var(--affinity-breathe-amp, 1.6)); }
}
@keyframes bgGainPulse {
  0% { opacity: 0; transform: scale(0.85); }
  25% { opacity: 0.4; transform: scale(1); }
  100% { opacity: 0; transform: scale(1.08); }
}
@keyframes bgLevelBloom {
  0% { opacity: 0; transform: scale(0.6); }
  20% { opacity: 0.65; transform: scale(1); }
  55% { opacity: 0.3; transform: scale(1.15); }
  100% { opacity: 0; transform: scale(1.3); }
}

/* ── AffinityBadge: heart beat & panel animations ── */
@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  14% { transform: scale(1.1); }
  28% { transform: scale(1); }
  42% { transform: scale(1.08); }
  70% { transform: scale(1); }
}
@keyframes fadeInDown {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeOutUp {
  from { opacity: 1; transform: translateY(0); }
  to { opacity: 0; transform: translateY(-8px); }
}
@keyframes popIn {
  from { opacity: 0; transform: scale(0.8) translateY(-4px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

/* ── Constellation: star field animations ── */
@keyframes constellationPulse {
  0%, 100% { box-shadow: 0 0 8px rgba(139,92,246,0.3), 0 0 2px rgba(139,92,246,0.15); }
  50% { box-shadow: 0 0 16px rgba(139,92,246,0.5), 0 0 4px rgba(139,92,246,0.3); }
}
@keyframes constellationBirth {
  0% { transform: scale(0); opacity: 0; filter: brightness(3); }
  50% { transform: scale(1.3); opacity: 1; filter: brightness(2); }
  100% { transform: scale(1); opacity: 1; filter: brightness(1); }
}
@keyframes constellationFlash {
  0% { box-shadow: 0 0 20px rgba(255,255,255,0.8), 0 0 40px rgba(139,92,246,0.6); transform: scale(1.15); }
  100% { box-shadow: 0 0 8px rgba(139,92,246,0.3); transform: scale(1); }
}

/* ── NetworkStatusBanner: slide in/out ── */
@keyframes netBannerSlideDown {
  from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
  to   { opacity: 1; transform: translateX(-50%) translateY(0); }
}
@keyframes netBannerFadeOut {
  0%, 70% { opacity: 1; transform: translateX(-50%) translateY(0); }
  100%    { opacity: 0; transform: translateX(-50%) translateY(-10px); }
}

/* ── ExperimentBar: link hover ── */
.experiment-bar-link:hover { opacity: 1 !important; }

/* ── ShortcutsOverlay: fade/slide ── */
@keyframes shortcutsFadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes shortcutsSlideIn {
  from { opacity: 0; transform: translateY(12px) scale(0.96); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

/* ── Shared overlay fade/slide (About, Pricing, Billing modals) ── */
@keyframes overlayFadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes overlayFadeOut { from { opacity: 1; } to { opacity: 0; } }
@keyframes overlaySlideIn {
  from { opacity: 0; transform: translateY(12px) scale(0.96); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes overlaySlideOut {
  from { opacity: 1; transform: translateY(0) scale(1); }
  to { opacity: 0; transform: translateY(12px) scale(0.96); }
}
.about-link {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 6px 14px; border-radius: 8px;
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.7);
  font-size: 12px; text-decoration: none;
  transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
  cursor: pointer;
}
.about-link:hover {
  background: rgba(139, 92, 246, 0.2);
  border-color: rgba(139, 92, 246, 0.4);
  color: var(--ling-purple-lighter);
}

/* ── InfoCrystal: @property for smooth affinity transitions + keyframes ── */
@property --cg-r { syntax: '<number>'; inherits: false; initial-value: 96; }
@property --cg-g { syntax: '<number>'; inherits: false; initial-value: 165; }
@property --cg-b { syntax: '<number>'; inherits: false; initial-value: 250; }
@property --cb-lo { syntax: '<length>'; inherits: false; initial-value: 10px; }
@property --cb-hi { syntax: '<length>'; inherits: false; initial-value: 22px; }
@property --cb-lo-a { syntax: '<number>'; inherits: false; initial-value: 0.12; }
@property --cb-hi-a { syntax: '<number>'; inherits: false; initial-value: 0.30; }
@property --cf-y { syntax: '<length>'; inherits: false; initial-value: 0px; }
@property --c-scale { syntax: '<number>'; inherits: false; initial-value: 1; }
@property --c-bg-alpha { syntax: '<number>'; inherits: false; initial-value: 0.60; }
@property --c-blur { syntax: '<length>'; inherits: false; initial-value: 16px; }
@property --ce-scale { syntax: '<number>'; inherits: false; initial-value: 1; }
@property --ce-y { syntax: '<length>'; inherits: false; initial-value: 0px; }

@keyframes crystalOverlayIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes crystalExpandIn {
  from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
  to   { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}
@keyframes crystalBreathe {
  0%, 100% { box-shadow: 0 0 var(--cb-lo) rgba(var(--cg-r), var(--cg-g), var(--cg-b), var(--cb-lo-a)); }
  50%      { box-shadow: 0 0 var(--cb-hi) rgba(var(--cg-r), var(--cg-g), var(--cg-b), var(--cb-hi-a)); }
}
@keyframes crystalEnter {
  from { opacity: 0; --ce-scale: 0.5; --ce-y: 40px; }
  to   { opacity: 1; --ce-scale: 1; --ce-y: 0px; }
}
@keyframes crystalFloat {
  0%, 100% { --cf-y: 0px; }
  50%      { --cf-y: var(--cf-range); }
}
@keyframes crystalExit {
  from { opacity: 1; transform: scale(1) translateY(0); }
  to   { opacity: 0; transform: scale(0.6) translateY(30px); }
}
@keyframes shimmerSweep {
  0%, 60%  { transform: translateX(-100%) rotate(25deg); }
  80%, 100% { transform: translateX(200%) rotate(25deg); }
}

/* ── MemoryPanel: hover interactions + staggered card entrance ── */
.ling-mem-close:hover { background: rgba(255,255,255,0.06) !important; color: rgba(255,255,255,0.6) !important; }
.ling-mem-close:active { background: rgba(255,255,255,0.08) !important; color: rgba(255,255,255,0.7) !important; transform: scale(0.9); }
.ling-memory-card:hover { background: rgba(255,255,255,0.07) !important; border-left-color: rgba(139,92,246,0.55) !important; }
@keyframes memCardIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

/* ── ChatArea: load-more button hover ── */
.ling-load-more:hover { background: var(--ling-surface-hover) !important; border-color: var(--ling-purple-25) !important; color: var(--ling-purple-light) !important; }
.ling-load-more:active { transform: scale(0.97); }

/* ── StreamingFooter: retry button hover ── */
.ling-retry-btn:hover { background: var(--ling-purple-30) !important; border-color: var(--ling-purple-40) !important; color: var(--ling-purple-lighter) !important; }
.ling-retry-btn:active { transform: scale(0.96); }

/* === 主题 color-scheme === */
:root {
  color-scheme: dark;
}
[data-theme="light"] {
  color-scheme: light;
}

/* === 窄屏聊天优化 (<400px) === */
@media (max-width: 400px) {
  /* 气泡占更多宽度，避免长文本过于狭长 */
  .chat-msg-inner {
    max-width: 92% !important;
  }

  /* 消息行两侧间距缩小：16px → 10px */
  .ling-msg-row {
    padding-left: 10px !important;
    padding-right: 10px !important;
  }

  /* 时间分割线间距缩小 */
  .ling-time-sep {
    padding-left: 16px !important;
    padding-right: 16px !important;
  }

  /* 欢迎卡片间距缩小 */
  .ling-welcome-card {
    padding: 16px !important;
  }

  /* 建议芯片缩小 */
  .welcome-chip {
    padding: 6px 12px !important;
    font-size: 12px !important;
  }

  /* 气泡水平间距收窄，给内容更多空间 */
  .ling-bubble {
    padding: 10px 12px !important;
  }
  .md-content > .code-block-wrap {
    margin-left: -12px;
    margin-right: -12px;
  }
  .md-content .code-block-header {
    padding-left: 12px;
    padding-right: 12px;
  }

  /* 代码块限高，避免窄屏上过高的代码区域 */
  .md-content .code-block-wrap pre {
    max-height: 300px;
    padding-left: 12px;
    padding-right: 12px;
  }
}

/* === Reduced motion 无障碍 === */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01s !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01s !important;
    scroll-behavior: auto !important;
  }
}
