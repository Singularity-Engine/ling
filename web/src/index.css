/* === 暗色主题变量 === */
:root {
  /* 基底色 */
  --ling-bg-deep: #0a0015;
  --ling-bg-mid: #0d1b2a;
  --ling-bg-warm: #1a0a2e;

  /* 主题紫 */
  --ling-purple: #8b5cf6;         /* 主色 rgb(139,92,246) */
  --ling-purple-light: #a78bfa;   /* 次色 rgb(167,139,250) */
  --ling-purple-lighter: #c4b5fd; /* 浅紫 */
  --ling-purple-deep: #6d28d9;    /* 深紫 */
  --ling-purple-text: #e2d4ff;    /* 紫调文字 */

  /* 表面/容器 */
  --ling-surface: rgba(255, 255, 255, 0.06);
  --ling-surface-hover: rgba(255, 255, 255, 0.1);
  --ling-surface-border: rgba(255, 255, 255, 0.08);
  --ling-surface-elevated: rgba(0, 0, 0, 0.35);

  /* 文字 */
  --ling-text-primary: rgba(255, 255, 255, 0.95);
  --ling-text-secondary: rgba(255, 255, 255, 0.75);
  --ling-text-tertiary: rgba(255, 255, 255, 0.4);
  --ling-text-muted: rgba(255, 255, 255, 0.2);

  /* 语义色 */
  --ling-success: #4ade80;
  --ling-warning: #fbbf24;
  --ling-error: #f87171;
  --ling-error-bg: rgba(248, 113, 113, 0.2);
  --ling-error-border: rgba(248, 113, 113, 0.3);

  /* 紫色常用透明度 */
  --ling-purple-15: rgba(139, 92, 246, 0.15);
  --ling-purple-20: rgba(139, 92, 246, 0.2);
  --ling-purple-25: rgba(139, 92, 246, 0.25);
  --ling-purple-30: rgba(139, 92, 246, 0.3);
  --ling-purple-40: rgba(139, 92, 246, 0.4);
  --ling-purple-50: rgba(139, 92, 246, 0.5);
  --ling-purple-60: rgba(139, 92, 246, 0.6);
  --ling-purple-70: rgba(139, 92, 246, 0.7);
  --ling-purple-85: rgba(139, 92, 246, 0.85);

  /* 气泡 */
  --ling-bubble-user-bg: linear-gradient(135deg, rgba(139, 92, 246, 0.52), rgba(109, 40, 217, 0.46));
  --ling-bubble-ai-bg: rgba(255, 255, 255, 0.09);
  --ling-bubble-user-border: rgba(139, 92, 246, 0.4);
  --ling-bubble-ai-border: rgba(255, 255, 255, 0.14);
  --ling-bubble-ai-accent: rgba(139, 92, 246, 0.6);
  --ling-bubble-user-shadow: rgba(139, 92, 246, 0.25);
  --ling-bubble-ai-shadow: rgba(0, 0, 0, 0.15);
  --ling-bubble-ai-text: rgba(255, 255, 255, 0.92);
  --ling-chat-timestamp: rgba(255, 255, 255, 0.5);
  --ling-chat-label: var(--ling-purple-60);
  --ling-collapse-mask-ai: linear-gradient(transparent, rgba(255, 255, 255, 0.06));
  --ling-collapse-mask-user: linear-gradient(transparent, rgba(109, 40, 217, 0.5));

  /* 代码块 */
  --ling-code-text: #c4b5fd;
  --ling-code-bg: rgba(10, 0, 21, 0.6);

  /* 全局背景（供 body 引用） */
  --ling-body-bg: linear-gradient(180deg, var(--ling-bg-deep) 0%, var(--ling-bg-mid) 50%, var(--ling-bg-warm) 100%);
  --ling-body-color: #ffffff;
  --ling-placeholder-color: rgba(255, 255, 255, 0.4);
  --ling-selection-color: #fff;
  --ling-md-em: rgba(200, 180, 255, 0.9);
  --ling-md-pre-code: rgba(255, 255, 255, 0.85);
  --ling-md-blockquote-color: rgba(255, 255, 255, 0.7);
  --ling-md-heading-color: rgba(255, 255, 255, 0.95);
}

/* === 亮色主题变量 === */
[data-theme="light"] {
  /* 基底色 */
  --ling-bg-deep: #f5f0ff;
  --ling-bg-mid: #ede5ff;
  --ling-bg-warm: #e8deff;

  /* 主题紫（保持不变，仅微调对比度） */
  --ling-purple: #7c3aed;
  --ling-purple-light: #8b5cf6;
  --ling-purple-lighter: #a78bfa;
  --ling-purple-deep: #6d28d9;
  --ling-purple-text: #4c1d95;

  /* 表面/容器 */
  --ling-surface: rgba(0, 0, 0, 0.04);
  --ling-surface-hover: rgba(0, 0, 0, 0.07);
  --ling-surface-border: rgba(0, 0, 0, 0.1);
  --ling-surface-elevated: rgba(255, 255, 255, 0.8);

  /* 文字 */
  --ling-text-primary: rgba(0, 0, 0, 0.9);
  --ling-text-secondary: rgba(0, 0, 0, 0.65);
  --ling-text-tertiary: rgba(0, 0, 0, 0.4);
  --ling-text-muted: rgba(0, 0, 0, 0.2);

  /* 语义色 */
  --ling-success: #16a34a;
  --ling-warning: #d97706;
  --ling-error: #dc2626;
  --ling-error-bg: rgba(220, 38, 38, 0.1);
  --ling-error-border: rgba(220, 38, 38, 0.2);

  /* 紫色常用透明度 */
  --ling-purple-15: rgba(124, 58, 237, 0.12);
  --ling-purple-20: rgba(124, 58, 237, 0.16);
  --ling-purple-25: rgba(124, 58, 237, 0.2);
  --ling-purple-30: rgba(124, 58, 237, 0.25);
  --ling-purple-40: rgba(124, 58, 237, 0.3);
  --ling-purple-50: rgba(124, 58, 237, 0.4);
  --ling-purple-60: rgba(124, 58, 237, 0.5);
  --ling-purple-70: rgba(124, 58, 237, 0.6);
  --ling-purple-85: rgba(124, 58, 237, 0.75);

  /* 气泡 */
  --ling-bubble-user-bg: linear-gradient(135deg, rgba(124, 58, 237, 0.28), rgba(109, 40, 217, 0.22));
  --ling-bubble-ai-bg: rgba(0, 0, 0, 0.045);
  --ling-bubble-user-border: rgba(124, 58, 237, 0.35);
  --ling-bubble-ai-border: rgba(0, 0, 0, 0.1);
  --ling-bubble-ai-accent: rgba(124, 58, 237, 0.5);
  --ling-bubble-user-shadow: rgba(124, 58, 237, 0.22);
  --ling-bubble-ai-shadow: rgba(0, 0, 0, 0.05);
  --ling-bubble-ai-text: rgba(0, 0, 0, 0.85);
  --ling-chat-timestamp: rgba(0, 0, 0, 0.4);
  --ling-chat-label: var(--ling-purple-60);
  --ling-collapse-mask-ai: linear-gradient(transparent, rgba(0, 0, 0, 0.06));
  --ling-collapse-mask-user: linear-gradient(transparent, rgba(124, 58, 237, 0.18));

  /* 代码块 */
  --ling-code-text: #6d28d9;
  --ling-code-bg: rgba(124, 58, 237, 0.08);

  /* 全局背景 */
  --ling-body-bg: linear-gradient(180deg, var(--ling-bg-deep) 0%, var(--ling-bg-mid) 50%, var(--ling-bg-warm) 100%);
  --ling-body-color: #1a1a2e;
  --ling-placeholder-color: rgba(0, 0, 0, 0.35);
  --ling-selection-color: #1a1a2e;
  --ling-md-em: rgba(109, 40, 217, 0.85);
  --ling-md-pre-code: rgba(0, 0, 0, 0.75);
  --ling-md-blockquote-color: rgba(0, 0, 0, 0.6);
  --ling-md-heading-color: rgba(0, 0, 0, 0.9);
}

/* === 全局基础 === */
html {
  background: var(--ling-bg-deep) !important;
}
body, html {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: var(--ling-body-bg) !important;
  min-height: 100vh;
  min-height: -webkit-fill-available;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans SC', 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', sans-serif;
  color: var(--ling-body-color);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* 防止 iOS 橡皮筋滚动 */
body {
  position: fixed;
  width: 100%;
  height: 100%;
  touch-action: manipulation;
}

/* === 滚动条 === */
::-webkit-scrollbar {
  width: 4px;
  height: 4px;
}
::-webkit-scrollbar-track {
  background: transparent;
}
::-webkit-scrollbar-thumb {
  background: var(--ling-purple-30);
  border-radius: 2px;
}
::-webkit-scrollbar-thumb:hover {
  background: var(--ling-purple-50);
}

/* === 动画 === */
@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideInRight {
  from { opacity: 0; transform: translateX(20px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes landingBtnSpin {
  to { transform: rotate(360deg); }
}

/* Landing — GPU-friendly glow breathing via opacity-only animation on ::after */
@keyframes breatheGlowOpacity {
  0%, 100% { opacity: 0; }
  50% { opacity: 1; }
}

.landing-start-btn::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  box-shadow: 0 0 45px var(--ling-purple-60), 0 0 90px var(--ling-purple-30);
  opacity: 0;
  animation: breatheGlowOpacity 3s ease-in-out infinite;
  pointer-events: none;
  will-change: opacity;
  transition: opacity 0.25s ease;
}
.landing-start-btn:not(:disabled):hover {
  transform: scale(1.06);
}
.landing-start-btn:not(:disabled):hover .landing-btn-arrow {
  transform: translateX(4px);
}
.landing-start-btn:not(:disabled):active {
  transform: scale(0.97);
  transition-duration: 0.1s;
}
.landing-start-btn:not(:disabled):hover::after {
  opacity: 1;
  animation: none;
}
.landing-start-btn:focus-visible {
  outline: 2px solid var(--ling-purple-lighter);
  outline-offset: 3px;
}

/* Landing 始终暗色主题——覆盖 [data-theme="light"] 的变量继承 */
[data-landing] {
  --ling-bg-deep: #0a0015;
  --ling-bg-mid: #0d1b2a;
  --ling-bg-warm: #1a0a2e;
  --ling-purple: #8b5cf6;
  --ling-purple-deep: #6d28d9;
  --ling-purple-lighter: #c4b5fd;
  --ling-purple-text: #e2d4ff;
  --ling-purple-20: rgba(139, 92, 246, 0.2);
  --ling-purple-30: rgba(139, 92, 246, 0.3);
  --ling-purple-40: rgba(139, 92, 246, 0.4);
  --ling-purple-60: rgba(139, 92, 246, 0.6);
  --ling-text-secondary: rgba(255, 255, 255, 0.75);
  --ling-purple-25: rgba(139, 92, 246, 0.25);
  --ling-text-tertiary: rgba(255, 255, 255, 0.4);
  --ling-text-muted: rgba(255, 255, 255, 0.2);
}

/* Landing text line */
.landing-text-line {
  position: relative;
}

/* Landing title — breathing glow after typewriter completes
 * GPU-friendly: static text-shadow (painted once) + opacity-only animated pseudo-element.
 * Replaces per-frame text-shadow animation that triggered full repaints. */
.landing-title-glow {
  text-shadow: 0 0 40px var(--ling-purple-40), 0 0 80px var(--ling-purple-20);
}
.landing-title-glow::before {
  content: '';
  position: absolute;
  inset: -40px -20px;
  border-radius: 50%;
  background: radial-gradient(ellipse at center, var(--ling-purple-40) 0%, var(--ling-purple-20) 40%, transparent 70%);
  opacity: 0;
  animation: breatheGlowOpacity 4s ease-in-out infinite;
  will-change: opacity;
  pointer-events: none;
  z-index: -1;
}

/* Landing title — gradient text with subtle shimmer sweep */
.landing-title-gradient {
  background: linear-gradient(
    90deg,
    #fff 0%, #e2d4ff 15%, #c4b5fd 30%, #a78bfa 45%,
    #fff 50%,
    #a78bfa 55%, #c4b5fd 70%, #e2d4ff 85%, #fff 100%
  );
  background-size: 200% 100%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: textShimmer 6s ease-in-out 1s infinite both;
}
@keyframes textShimmer {
  0%, 35% { background-position: 100% center; }
  65%, 100% { background-position: -100% center; }
}

/* Landing feature pills */
.landing-feature-pills {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: center;
}
/* Landing hint — CSS media query instead of JS layout read */
.landing-hint-mobile { display: none; }
.landing-hint-desktop { display: inline; }

.landing-feature-pill {
  padding: 4px 14px;
  font-size: 0.7rem;
  color: var(--ling-text-tertiary);
  border: 1px solid var(--ling-purple-20);
  border-radius: 999px;
  letter-spacing: 0.04em;
  white-space: nowrap;
}

@keyframes skeletonPulse {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 0.8; }
}

@keyframes skeletonOrb {
  0%, 100% { transform: scale(0.95); opacity: 0.3; }
  50% { transform: scale(1.05); opacity: 0.6; }
}

@keyframes skeletonBarShimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(200%); }
}

@keyframes indicatorBreathe {
  0%, 100% { box-shadow: 0 0 12px rgba(139, 92, 246, 0.3), 0 2px 8px rgba(0, 0, 0, 0.2); }
  50% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.5), 0 2px 12px rgba(0, 0, 0, 0.25); }
}

/* Live2D 点击粒子 */
@keyframes tapParticleFloat {
  0% { opacity: 1; transform: translateY(0) translateX(0) scale(1); }
  70% { opacity: 1; }
  100% { opacity: 0; transform: translateY(-90px) translateX(var(--drift, 0px)) scale(0.4); }
}
.ling-tap-particle {
  animation: tapParticleFloat 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  will-change: transform, opacity;
  filter: drop-shadow(0 0 4px rgba(139, 92, 246, 0.5));
  user-select: none;
}

/* === 选择样式 === */
::selection {
  background: var(--ling-purple-30);
  color: var(--ling-selection-color);
}

/* === 输入框 placeholder === */
input::placeholder, textarea::placeholder {
  color: var(--ling-placeholder-color);
}

/* === 聚焦环 === */
*:focus-visible {
  outline: 2px solid var(--ling-purple-50);
  outline-offset: 2px;
}

/* === Canvas 层 === */
canvas {
  display: block;
}

/* === 移动端触摸优化 === */
@media (max-width: 768px) {
  /* 长文本气泡在移动端更宽，避免 500+ 字消息过窄过高 */
  .chat-msg-inner {
    max-width: 90% !important;
  }

  /* 禁止长按选择 */
  * {
    -webkit-touch-callout: none;
  }

  /* 输入框在移动端不缩放 */
  input, textarea {
    font-size: 16px !important; /* 防止 iOS 自动缩放 */
  }


  /* Landing 动画移动端优化 */
  .landing-text-line {
    font-size: 15px !important;
    line-height: 1.5 !important;
  }
  .landing-text-line:first-child {
    font-size: 26px !important;
    min-height: 2.5rem !important; /* override inline 4.5rem — proportional to 26px mobile font */
    letter-spacing: 0.08em !important; /* tighter than desktop 0.12em */
  }
  .landing-text-line:nth-child(2) {
    font-size: 17px !important;
  }
  .landing-start-btn {
    padding: 16px 40px !important;
    font-size: 16px !important;
    min-height: 48px !important;
  }
  .landing-hint-mobile { display: inline; }
  .landing-hint-desktop { display: none; }
}

/* === Markdown 内容（AI 气泡） === */
.md-content {
  word-break: break-word; /* fallback for older WebViews that lack overflow-wrap:anywhere */
  overflow-wrap: anywhere;
  min-width: 0;
}
.md-content p { margin: 0 0 0.5em; }
.md-content p:last-child { margin-bottom: 0; }
.md-content strong { color: var(--ling-text-primary); }
.md-content em { color: var(--ling-md-em); }
.md-content del { color: var(--ling-text-tertiary); }
.md-content a, .user-msg-link { color: var(--ling-purple-light); text-decoration: none; border-bottom: 1px solid rgba(167,139,250,0.3); transition: border-color 0.2s; overflow-wrap: anywhere; }
.md-content a:hover, .user-msg-link:hover { border-color: var(--ling-purple-light); }
.md-content img { max-width: 100%; height: auto; }
.md-content code {
  background: var(--ling-purple-15);
  color: var(--ling-code-text);
  padding: 1px 5px;
  border-radius: 4px;
  font-size: 0.9em;
  font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', monospace;
  overflow-wrap: anywhere;
}
/* Code block wrapper — full-bleed to bubble edges for more code space */
.md-content .code-block-wrap {
  position: relative;
  margin: 0.5em -16px;
  border-top: 1px solid var(--ling-purple-25);
  border-bottom: 1px solid var(--ling-purple-25);
  border-left: none;
  border-right: none;
  border-radius: 0;
  overflow: hidden;
  background: var(--ling-code-bg);
}
.md-content .code-block-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 12px;
  background: rgba(255, 255, 255, 0.04);
  border-bottom: 1px solid var(--ling-purple-15);
  min-height: 28px;
}
.md-content .code-block-lang {
  font-size: 11px;
  font-weight: 500;
  color: var(--ling-text-tertiary);
  letter-spacing: 0.3px;
  user-select: none;
}
.md-content .code-block-copy {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  margin-left: auto;
  background: transparent;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  padding: 0;
  color: var(--ling-text-tertiary);
  transition: color 0.15s, background 0.15s, transform 0.15s;
}
.md-content .code-block-copy:hover {
  color: var(--ling-text-secondary);
  background: rgba(255, 255, 255, 0.08);
}
.md-content .code-block-copy:active {
  transform: scale(0.88);
  color: var(--ling-text-secondary);
  background: rgba(255, 255, 255, 0.12);
}
.md-content .code-block-wrap pre {
  margin: 0;
  border: none;
  border-radius: 0;
  background: transparent;
  padding: 10px 14px;
  overflow: auto;
  max-height: 500px;
  line-height: 1.5;
  scrollbar-width: thin;
  scrollbar-color: var(--ling-purple-40) transparent;
}
.md-content .code-block-wrap pre::-webkit-scrollbar {
  height: 6px;
  width: 6px;
}
.md-content .code-block-wrap pre::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.04);
  border-radius: 3px;
}
.md-content .code-block-wrap pre::-webkit-scrollbar-thumb {
  background: var(--ling-purple-40);
  border-radius: 3px;
}
/* Standalone pre (no wrapper) — fallback */
.md-content pre:not(.code-block-wrap pre) {
  background: var(--ling-code-bg);
  border: 1px solid var(--ling-purple-25);
  border-radius: 8px;
  padding: 10px 14px;
  overflow: auto;
  max-height: 500px;
  line-height: 1.5;
  margin: 0.5em 0;
}
.md-content pre code {
  background: none;
  padding: 0;
  font-size: 0.85em;
  color: var(--ling-md-pre-code);
  word-break: normal;
  overflow-wrap: normal;
  overflow: visible;
}
.md-content ul, .md-content ol { margin: 0.4em 0; padding-left: 1.5em; }
.md-content li { margin-bottom: 0.2em; }
.md-content blockquote {
  margin: 0.5em 0;
  padding: 4px 12px;
  border-left: 3px solid var(--ling-purple-40);
  color: var(--ling-md-blockquote-color);
}
.md-content h1, .md-content h2, .md-content h3,
.md-content h4, .md-content h5, .md-content h6 {
  margin: 0.6em 0 0.3em;
  color: var(--ling-md-heading-color);
  font-weight: 600;
}
.md-content h1 { font-size: 1.3em; }
.md-content h2 { font-size: 1.15em; }
.md-content h3 { font-size: 1.05em; }
/* GFM task list (checkbox) */
.md-content input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  border: 1.5px solid var(--ling-purple-40);
  border-radius: 3px;
  background: transparent;
  vertical-align: middle;
  margin: 0 6px 0 0;
  position: relative;
  cursor: default;
}
.md-content input[type="checkbox"]:checked {
  background: var(--ling-purple);
  border-color: var(--ling-purple);
}
.md-content input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 3px;
  top: 0.5px;
  width: 5px;
  height: 8px;
  border: solid #fff;
  border-width: 0 1.5px 1.5px 0;
  transform: rotate(45deg);
}
.md-content li:has(> input[type="checkbox"]) {
  list-style: none;
  margin-left: -1.5em;
}
.md-content hr {
  border: none;
  border-top: 1px solid var(--ling-purple-15);
  margin: 0.6em 0;
}
/* Table — scrollable wrapper to prevent bubble overflow */
.md-content table {
  display: block;
  overflow-x: auto;
  max-width: 100%;
  border-collapse: collapse;
  margin: 0.5em 0;
  font-size: 0.9em;
  scrollbar-width: thin;
  scrollbar-color: var(--ling-purple-40) transparent;
}
.md-content table::-webkit-scrollbar { height: 6px; }
.md-content table::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.04); border-radius: 3px; }
.md-content table::-webkit-scrollbar-thumb { background: var(--ling-purple-40); border-radius: 3px; }
.md-content th, .md-content td {
  padding: 6px 12px;
  border: 1px solid var(--ling-purple-25);
}
.md-content td {
  overflow-wrap: break-word;
}
.md-content th {
  background: rgba(255, 255, 255, 0.04);
  font-weight: 600;
  color: var(--ling-md-heading-color);
  white-space: nowrap;
}
.md-content tr:nth-child(even) {
  background: rgba(255, 255, 255, 0.02);
}

/* === 主题 color-scheme === */
:root {
  color-scheme: dark;
}
[data-theme="light"] {
  color-scheme: light;
}

/* === 窄屏聊天优化 (<400px) === */
@media (max-width: 400px) {
  /* 气泡占更多宽度，避免长文本过于狭长 */
  .chat-msg-inner {
    max-width: 92% !important;
  }

  /* 消息行两侧间距缩小：16px → 10px */
  .ling-msg-row {
    padding-left: 10px !important;
    padding-right: 10px !important;
  }

  /* 时间分割线间距缩小 */
  .ling-time-sep {
    padding-left: 16px !important;
    padding-right: 16px !important;
  }

  /* 欢迎卡片间距缩小 */
  .ling-welcome-card {
    padding: 16px !important;
  }

  /* 建议芯片缩小 */
  .welcome-chip {
    padding: 6px 12px !important;
    font-size: 12px !important;
  }

  /* 代码块限高，避免窄屏上过高的代码区域 */
  .md-content .code-block-wrap pre {
    max-height: 300px;
  }
}

/* === Reduced motion 无障碍 === */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01s !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01s !important;
    scroll-behavior: auto !important;
  }
}
