# Live2D 点击功能配置说明

## 🔧 已完成的配置更改

### 1. 模型文件配置 (`细雨气量贩-小狗.model3.json`)

#### 添加了点击区域定义：
```json
"HitAreas": [
    {
        "Name": "HitAreaHead",
        "Id": "HitAreaHead", 
        "X": 0.0,
        "Y": 0.3,
        "Width": 1.4,
        "Height": 0.8
    },
    {
        "Name": "HitAreaBody",
        "Id": "HitAreaBody",
        "X": 0.0,
        "Y": -0.3,
        "Width": 2.0,
        "Height": 1.8
    }
]
```

#### 点击区域说明：
- **头部区域**：覆盖模型头部及周围区域，便于点击触发头部动作
- **身体区域**：覆盖模型全身，包括左右两侧，确保全身都能响应点击

### 2. 动作配置 (`model_dict.json`)

#### 点击触发配置：
```json
"tapMotions": {
    "HitAreaBody": {
        "TapBody": 25,     // 25% 概率触发普通身体动作
        "Happy": 20,       // 20% 概率触发开心表情
        "sese": 20,        // 20% 概率触发调皮动作
        "Sway": 35         // 35% 概率触发身体摆动
    },
    "HitAreaHead": {
        "TapHead": 25,     // 25% 概率触发普通头部动作
        "Happy": 20,       // 20% 概率触发开心表情
        "sese": 20,        // 20% 概率触发调皮动作
        "Nod": 30,         // 30% 概率触发点头
        "Shake": 25        // 25% 概率触发摇头
    }
}
```

### 3. 后端处理器 (`websocket_handler.py`)

#### 新增消息处理器：
- 新增 `"live2d-tap"` 消息类型处理
- 实现 `_handle_live2d_tap()` 方法
- 支持随机权重选择动作

### 4. 动作数据结构 (`output_types.py`)

#### 扩展Actions类：
- 新增 `motions: Optional[List[str]] = None` 属性

## 🎮 使用方法

### 前端点击触发
1. **点击头部区域**：随机触发点头、摇头、开心表情等动作
2. **点击身体区域**：随机触发身体摆动、开心表情、调皮动作等

### 程序化触发
发送WebSocket消息：
```json
{
    "type": "live2d-tap",
    "hitAreaName": "HitAreaHead"  // 或 "HitAreaBody"
}
```

## 🧪 测试方法

### 方法1：直接点击模型测试
1. 启动服务器：`uv run run_server.py`
2. 打开浏览器访问 `http://localhost:12393`
3. 尝试点击模型的头部和身体部位

### 方法2：使用测试脚本
1. 运行测试脚本：`python test_tap_event.py`
2. 观察控制台输出的动作响应

## 📊 动作权重配置

当前配置的动作权重分布：

### 头部点击
- 点头：30% （新增）
- 摇头：25% （新增）
- 普通头部动作：25%
- 开心表情：20%
- 调皮动作：20%

### 身体点击
- 身体摆动：35% （新增）
- 普通身体动作：25%
- 开心表情：20%
- 调皮动作：20%

## 🔍 故障排除

### 如果点击没有反应：
1. 检查服务器日志是否有错误
2. 确认HitAreas配置正确
3. 验证动作文件是否存在
4. 检查浏览器控制台是否有JavaScript错误

### 调整点击区域：
在 `细雨气量贩-小狗.model3.json` 中修改 `HitAreas` 的坐标和尺寸：
- `X, Y`: 点击区域中心坐标
- `Width, Height`: 点击区域大小

### 调整动作权重：
在 `model_dict.json` 中修改 `tapMotions` 的数值来改变触发概率

## 🎯 下一步扩展

可以考虑添加：
1. 更多点击区域（如眼睛、嘴巴等）
2. 连击检测（快速多次点击触发特殊动作）
3. 点击组合（同时点击多个区域）
4. 基于时间的动作变化（如长按触发不同动作）

## 📝 注意事项

- 所有动作文件必须存在于 `按键/` 目录下
- 动作权重总和不需要等于100，系统会自动计算比例
- 新增动作后需要重启服务器才能生效
- 前端可能需要适配新的消息格式（`live2d-action`） 